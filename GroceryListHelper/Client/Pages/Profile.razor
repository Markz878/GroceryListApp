@page "/profile"
@inherits ProfileBase
<Microsoft.AspNetCore.Components.Web.Extensions.Head.Title Value="Profile" />

<AuthorizeView Context="authContext">
    <h2> Profile settings for @authContext.User.FindFirst("email").Value</h2>

    <fieldset>
        <legend>Change password</legend>
        <div class="form-info">Change your password by submitting the form below:</div>
        <EditForm Model="changePasswordRequest" OnValidSubmit="ChangePassword">
            <DataAnnotationsValidator />
            <ValidationSummary />
            <CustomValidationMessage Message="@passwordMessage" />
            <InputTextComponent DisplayName="Current password" IsPassword="true" @bind-Value="changePasswordRequest.CurrentPassword " />
            <InputTextComponent DisplayName="New password" IsPassword="true" @bind-Value="changePasswordRequest.NewPassword" />
            <InputTextComponent DisplayName="Confirm new password" IsPassword="true" @bind-Value="changePasswordRequest.ConfirmNewPassword" />
            <button class="btn btn-primary" type="submit" disabled="@isBusy">Change password</button>
        </EditForm>
    </fieldset>

    <fieldset>
        <legend>Request personal info</legend>
        <div class="form-info">Download your personal information:</div>
        @if (!string.IsNullOrEmpty(downloadMessage))
        {
            <ul>
                <li class="validation-message">@downloadMessage</li>
            </ul>
        }
        <button class="btn btn-primary" @onclick="DownloadPersonalInfo">Download</button>
    </fieldset>

    <fieldset>
        <legend>Delete profile</legend>
        <div class="form-info">You can delete your profile by submitting the form below (can't be undone):</div>
        <EditForm Model="deleteProfileRequest" OnValidSubmit="DeleteProfile">
            <DataAnnotationsValidator />
            <ValidationSummary />
            <CustomValidationMessage Message="@deleteMessage" />
            <InputTextComponent DisplayName="Password" IsPassword="true" @bind-Value="deleteProfileRequest.Password" />
            <button class="btn btn-danger" type="submit" disabled="@isBusy">Delete profile</button>
        </EditForm>
    </fieldset>

</AuthorizeView>


