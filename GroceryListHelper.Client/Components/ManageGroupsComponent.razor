@using GroceryListHelper.Shared.Models.CartGroups

<CascadingValue Value="AppState">
    <div class="p-4">
        @if (isCreatingNewGroup)
        {
            <fieldset class="mt-4 p-4 border-2 border-gray-300 rounded-lg">
                <legend class="text-lg font-bold px-1">Create cart group</legend>
                <input id="create-group-name" class="form-control" @bind="createCartGroupRequest.Name" maxlength="30" size="30" placeholder="Group name" />
                <div class="flex flex-wrap mr-2 mb-2 px-[5px] py-1 items-center">
                    <p class="mr-2">Members: </p>
                    @foreach (string email in createCartGroupRequest.OtherUsers)
                    {
                        <div class="flex mx-3 my-1">
                            <span class="align-middle">@email</span>
                            <button class="btn btn-danger w-6 h-6 p-0 leading-4 ml-1 font-bold" @onclick="() => RemoveNewMember(email)">&times;</button>
                        </div>
                    }
                </div>
                <div class="flex">
                    <input id="add-user-to-group" class="form-control" @bind="newMemberEmail.Email" size="30" placeholder="New member email" />
                    <button id="add-member-btn" class="btn btn-success w-9 h-9 p-0 ml-2 font-extrabold text-2xl" @onclick="AddMember">+</button>
                </div>
                <button id="create-group-btn" class="btn btn-success flex items-center mt-4 gap-2" @onclick=CreateGroup>
                    <img src="icons/group.svg" class="m-auto h-5 invert" />
                    @if (isBusy is false)
                    {
                        <span>Create Group</span>
                    }
                    else
                    {
                        <div class="flex items-center">
                            <span class="border-4 border-[rgba(0,0,0,0.1)] border-t-white rounded-[50%] w-4 h-4 mr-2 animate-spin"></span>
                            <span>Creating...</span>
                        </div>
                    }
                </button>
            </fieldset>
        }
        else
        {
            <button id="create-group-btn" class="btn btn-success flex items-center gap-2" @onclick="CreateGroup">
                <img src="icons/group.svg" class="m-auto h-5 invert" />
                Create group
            </button>
        }
        @if (CartGroups is null || CartGroups.Count == 0)
        {
            <p>You have no groups yet.</p>
        }
        else
        {
            @foreach (CartGroup group in CartGroups)
            {
                <fieldset class="mt-4 p-4 border-2 border-gray-300 rounded-lg">
                    @if (isEditingGroup != group)
                    {
                        <a href="groupcart/@group.Id" class="btn btn-primary inline-flex align-middle gap-2" aria-label="Select group cart">
                            <svg class="w-4 invert" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
                                <path d="M152.1 38.2c9.9 8.9 10.7 24 1.8 33.9l-72 80c-4.4 4.9-10.6 7.8-17.2 7.9s-12.9-2.4-17.6-7L7 113C-2.3 103.6-2.3 88.4 7 79s24.6-9.4 33.9 0l22.1 22.1 55.1-61.2c8.9-9.9 24-10.7 33.9-1.8zm0 160c9.9 8.9 10.7 24 1.8 33.9l-72 80c-4.4 4.9-10.6 7.8-17.2 7.9s-12.9-2.4-17.6-7L7 273c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l22.1 22.1 55.1-61.2c8.9-9.9 24-10.7 33.9-1.8zM224 96c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H256c-17.7 0-32-14.3-32-32zm0 160c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H256c-17.7 0-32-14.3-32-32zM160 416c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H192c-17.7 0-32-14.3-32-32zM48 368a48 48 0 1 1 0 96 48 48 0 1 1 0-96z" />
                            </svg>
                            <span>@group.Name</span>
                        </a>
                        <button class="btn btn-success h-8 w-8 p-[3px]" @onclick="() => EditGroup(group)" aria-label="Edit group name" disabled="@(isEditingGroup != null)">
                            <img src="icons/edit.svg" class="m-auto invert" />
                        </button>
                        <button class="btn btn-danger p-[4px] w-8 h-8 text-lg leading-4" @onclick="() => ShowDeleteConfirm(group)" aria-label="Delete group">
                            <img src="icons/delete.svg" class="m-auto invert" />
                        </button>
                    }
                    else
                    {
                        <input id="edit-group-name-input" class="h-8 form-control-small" aria-label="Group name input" @bind="group.Name" />
                        <button class="btn btn-success h-8 w-8 p-0" aria-label="Submit name edit" @onclick="() => SubmitEditGroup(group)">
                            <img src="icons/check.svg" class="p-0" aria-hidden="true" />
                        </button>
                        <button class="btn btn-danger p-0 w-8 h-8 text-lg" aria-label="Cancel name edit" @onclick="() => StopEditGroup()">&times;</button>
                    }
                    <p class="mt-2 mb-0">Members: You, @string.Join(", ", group.OtherUsers)</p>
                </fieldset>
            }
        }
    </div>
    <Confirm Header="Confirm delete" Message="This will delete the group and its products for all group members, are you sure?" OkCallback="DeleteGroup" CancelCallback="CancelGroupDelete" @ref=confirm />
    <Modal />
</CascadingValue>
