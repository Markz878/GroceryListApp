var nr=Object.defineProperty;var rr=(n,e,t)=>e in n?nr(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var H=(n,e,t)=>(rr(n,typeof e!="symbol"?e+"":e,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function J(){}function $n(n,e){for(const t in e)n[t]=e[t];return n}function Mn(n){return n()}function Yt(){return Object.create(null)}function ae(n){n.forEach(Mn)}function it(n){return typeof n=="function"}function be(n,e){return n!=n?e==e:n!==e||n&&typeof n=="object"||typeof n=="function"}let ht;function Ie(n,e){return n===e?!0:(ht||(ht=document.createElement("a")),ht.href=e,n===ht.href)}function sr(n){return Object.keys(n).length===0}function Bt(n,...e){if(n==null){for(const r of e)r(void 0);return J}const t=n.subscribe(...e);return t.unsubscribe?()=>t.unsubscribe():t}function Ln(n){let e;return Bt(n,t=>e=t)(),e}function Pe(n,e,t){n.$$.on_destroy.push(Bt(e,t))}function Ot(n){return n&&it(n.destroy)?n.destroy:J}const or=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function d(n,e){n.appendChild(e)}function A(n,e,t){n.insertBefore(e,t||null)}function U(n){n.parentNode&&n.parentNode.removeChild(n)}function Wt(n,e){for(let t=0;t<n.length;t+=1)n[t]&&n[t].d(e)}function _(n){return document.createElement(n)}function Zt(n){return document.createElementNS("http://www.w3.org/2000/svg",n)}function j(n){return document.createTextNode(n)}function P(){return j(" ")}function kt(){return j("")}function q(n,e,t,r){return n.addEventListener(e,t,r),()=>n.removeEventListener(e,t,r)}function u(n,e,t){t==null?n.removeAttribute(e):n.getAttribute(e)!==t&&n.setAttribute(e,t)}function wt(n){return n===""?null:+n}function ir(n){return Array.from(n.childNodes)}function te(n,e){e=""+e,n.data!==e&&(n.data=e)}function fe(n,e){n.value=e??""}function bt(n,e,t,r){t==null?n.style.removeProperty(e):n.style.setProperty(e,t,r?"important":"")}function ar(n,e,{bubbles:t=!1,cancelable:r=!1}={}){return new CustomEvent(n,{detail:e,bubbles:t,cancelable:r})}function yt(n,e){return new n(e)}let rt;function Ze(n){rt=n}function It(){if(!rt)throw new Error("Function called outside component initialization");return rt}function Xe(n){It().$$.on_mount.push(n)}function cr(n){It().$$.after_update.push(n)}function Nn(n){It().$$.on_destroy.push(n)}function Hn(){const n=It();return(e,t,{cancelable:r=!1}={})=>{const s=n.$$.callbacks[e];if(s){const o=ar(e,t,{cancelable:r});return s.slice().forEach(i=>{i.call(n,o)}),!o.defaultPrevented}return!0}}function Qt(n,e){const t=n.$$.callbacks[e.type];t&&t.slice().forEach(r=>r.call(this,e))}const ze=[],Ne=[];let Fe=[];const en=[],Bn=Promise.resolve();let Lt=!1;function On(){Lt||(Lt=!0,Bn.then(Wn))}function lr(){return On(),Bn}function Nt(n){Fe.push(n)}const Ut=new Set;let Oe=0;function Wn(){if(Oe!==0)return;const n=rt;do{try{for(;Oe<ze.length;){const e=ze[Oe];Oe++,Ze(e),ur(e.$$)}}catch(e){throw ze.length=0,Oe=0,e}for(Ze(null),ze.length=0,Oe=0;Ne.length;)Ne.pop()();for(let e=0;e<Fe.length;e+=1){const t=Fe[e];Ut.has(t)||(Ut.add(t),t())}Fe.length=0}while(ze.length);for(;en.length;)en.pop()();Lt=!1,Ut.clear(),Ze(n)}function ur(n){if(n.fragment!==null){n.update(),ae(n.before_update);const e=n.dirty;n.dirty=[-1],n.fragment&&n.fragment.p(n.ctx,e),n.after_update.forEach(Nt)}}function hr(n){const e=[],t=[];Fe.forEach(r=>n.indexOf(r)===-1?e.push(r):t.push(r)),t.forEach(r=>r()),Fe=e}const _t=new Set;let $e;function at(){$e={r:0,c:[],p:$e}}function ct(){$e.r||ae($e.c),$e=$e.p}function Q(n,e){n&&n.i&&(_t.delete(n),n.i(e))}function ne(n,e,t,r){if(n&&n.o){if(_t.has(n))return;_t.add(n),$e.c.push(()=>{_t.delete(n),r&&(t&&n.d(1),r())}),n.o(e)}else r&&r()}function Te(n){return(n==null?void 0:n.length)!==void 0?n:Array.from(n)}function fr(n,e){n.d(1),e.delete(n.key)}function dr(n,e,t,r,s,o,i,a,c,l,h,f){let p=n.length,g=o.length,w=p;const E={};for(;w--;)E[n[w].key]=w;const C=[],x=new Map,I=new Map,D=[];for(w=g;w--;){const R=f(s,o,w),$=t(R);let O=i.get($);O?r&&D.push(()=>O.p(R,e)):(O=l($,R),O.c()),x.set($,C[w]=O),$ in E&&I.set($,Math.abs(w-E[$]))}const S=new Set,b=new Set;function y(R){Q(R,1),R.m(a,h),i.set(R.key,R),h=R.first,g--}for(;p&&g;){const R=C[g-1],$=n[p-1],O=R.key,T=$.key;R===$?(h=R.first,p--,g--):x.has(T)?!i.has(O)||S.has(O)?y(R):b.has(T)?p--:I.get(O)>I.get(T)?(b.add(O),y(R)):(S.add(T),p--):(c($,i),p--)}for(;p--;){const R=n[p];x.has(R.key)||c(R,i)}for(;g;)y(C[g-1]);return ae(D),C}function vt(n,e){const t={},r={},s={$$scope:1};let o=n.length;for(;o--;){const i=n[o],a=e[o];if(a){for(const c in i)c in a||(r[c]=1);for(const c in a)s[c]||(t[c]=a[c],s[c]=1);n[o]=a}else for(const c in i)s[c]=1}for(const i in r)i in t||(t[i]=void 0);return t}function St(n){return typeof n=="object"&&n!==null?n:{}}function de(n){n&&n.c()}function ue(n,e,t){const{fragment:r,after_update:s}=n.$$;r&&r.m(e,t),Nt(()=>{const o=n.$$.on_mount.map(Mn).filter(it);n.$$.on_destroy?n.$$.on_destroy.push(...o):ae(o),n.$$.on_mount=[]}),s.forEach(Nt)}function he(n,e){const t=n.$$;t.fragment!==null&&(hr(t.after_update),ae(t.on_destroy),t.fragment&&t.fragment.d(e),t.on_destroy=t.fragment=null,t.ctx=[])}function pr(n,e){n.$$.dirty[0]===-1&&(ze.push(n),On(),n.$$.dirty.fill(0)),n.$$.dirty[e/31|0]|=1<<e%31}function ve(n,e,t,r,s,o,i=null,a=[-1]){const c=rt;Ze(n);const l=n.$$={fragment:null,ctx:[],props:o,update:J,not_equal:s,bound:Yt(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(c?c.$$.context:[])),callbacks:Yt(),dirty:a,skip_bound:!1,root:e.target||c.$$.root};i&&i(l.root);let h=!1;if(l.ctx=t?t(n,e.props||{},(f,p,...g)=>{const w=g.length?g[0]:p;return l.ctx&&s(l.ctx[f],l.ctx[f]=w)&&(!l.skip_bound&&l.bound[f]&&l.bound[f](w),h&&pr(n,f)),p}):[],l.update(),h=!0,ae(l.before_update),l.fragment=r?r(l.ctx):!1,e.target){if(e.hydrate){const f=ir(e.target);l.fragment&&l.fragment.l(f),f.forEach(U)}else l.fragment&&l.fragment.c();e.intro&&Q(n.$$.fragment),ue(n,e.target,e.anchor),Wn()}Ze(c)}class Se{constructor(){H(this,"$$");H(this,"$$set")}$destroy(){he(this,1),this.$destroy=J}$on(e,t){if(!it(t))return J;const r=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return r.push(t),()=>{const s=r.indexOf(t);s!==-1&&r.splice(s,1)}}$set(e){this.$$set&&!sr(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const gr="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(gr);const We=[];function zn(n,e){return{subscribe:xe(n,e).subscribe}}function xe(n,e=J){let t;const r=new Set;function s(a){if(be(n,a)&&(n=a,t)){const c=!We.length;for(const l of r)l[1](),We.push(l,n);if(c){for(let l=0;l<We.length;l+=2)We[l][0](We[l+1]);We.length=0}}}function o(a){s(a(n))}function i(a,c=J){const l=[a,c];return r.add(l),r.size===1&&(t=e(s,o)||J),a(n),()=>{r.delete(l),r.size===0&&t&&(t(),t=null)}}return{set:s,update:o,subscribe:i}}function Pt(n,e,t){const r=!Array.isArray(n),s=r?[n]:n;if(!s.every(Boolean))throw new Error("derived() expects stores as input, got a falsy value");const o=e.length<2;return zn(t,(i,a)=>{let c=!1;const l=[];let h=0,f=J;const p=()=>{if(h)return;f();const w=e(r?l[0]:l,i,a);o?i(w):f=it(w)?w:J},g=s.map((w,E)=>Bt(w,C=>{l[E]=C,h&=~(1<<E),c&&p()},()=>{h|=1<<E}));return c=!0,p(),function(){ae(g),f(),c=!1}})}function _r(n,e){if(n instanceof RegExp)return{keys:!1,pattern:n};var t,r,s,o,i=[],a="",c=n.split("/");for(c[0]||c.shift();s=c.shift();)t=s[0],t==="*"?(i.push("wild"),a+="/(.*)"):t===":"?(r=s.indexOf("?",1),o=s.indexOf(".",1),i.push(s.substring(1,~r?r:~o?o:s.length)),a+=~r&&!~o?"(?:/([^/]+?))?":"/([^/]+?)",~o&&(a+=(~r?"?":"")+"\\"+s.substring(o))):a+="/"+s;return{keys:i,pattern:new RegExp("^"+a+(e?"(?=$|/)":"/?$"),"i")}}function mr(n){let e,t,r;const s=[n[2]];var o=n[0];function i(a,c){let l={};if(c!==void 0&&c&4)l=vt(s,[St(a[2])]);else for(let h=0;h<s.length;h+=1)l=$n(l,s[h]);return{props:l}}return o&&(e=yt(o,i(n)),e.$on("routeEvent",n[7])),{c(){e&&de(e.$$.fragment),t=kt()},m(a,c){e&&ue(e,a,c),A(a,t,c),r=!0},p(a,c){if(c&1&&o!==(o=a[0])){if(e){at();const l=e;ne(l.$$.fragment,1,0,()=>{he(l,1)}),ct()}o?(e=yt(o,i(a,c)),e.$on("routeEvent",a[7]),de(e.$$.fragment),Q(e.$$.fragment,1),ue(e,t.parentNode,t)):e=null}else if(o){const l=c&4?vt(s,[St(a[2])]):{};e.$set(l)}},i(a){r||(e&&Q(e.$$.fragment,a),r=!0)},o(a){e&&ne(e.$$.fragment,a),r=!1},d(a){a&&U(t),e&&he(e,a)}}}function wr(n){let e,t,r;const s=[{params:n[1]},n[2]];var o=n[0];function i(a,c){let l={};if(c!==void 0&&c&6)l=vt(s,[c&2&&{params:a[1]},c&4&&St(a[2])]);else for(let h=0;h<s.length;h+=1)l=$n(l,s[h]);return{props:l}}return o&&(e=yt(o,i(n)),e.$on("routeEvent",n[6])),{c(){e&&de(e.$$.fragment),t=kt()},m(a,c){e&&ue(e,a,c),A(a,t,c),r=!0},p(a,c){if(c&1&&o!==(o=a[0])){if(e){at();const l=e;ne(l.$$.fragment,1,0,()=>{he(l,1)}),ct()}o?(e=yt(o,i(a,c)),e.$on("routeEvent",a[6]),de(e.$$.fragment),Q(e.$$.fragment,1),ue(e,t.parentNode,t)):e=null}else if(o){const l=c&6?vt(s,[c&2&&{params:a[1]},c&4&&St(a[2])]):{};e.$set(l)}},i(a){r||(e&&Q(e.$$.fragment,a),r=!0)},o(a){e&&ne(e.$$.fragment,a),r=!1},d(a){a&&U(t),e&&he(e,a)}}}function br(n){let e,t,r,s;const o=[wr,mr],i=[];function a(c,l){return c[1]?0:1}return e=a(n),t=i[e]=o[e](n),{c(){t.c(),r=kt()},m(c,l){i[e].m(c,l),A(c,r,l),s=!0},p(c,[l]){let h=e;e=a(c),e===h?i[e].p(c,l):(at(),ne(i[h],1,1,()=>{i[h]=null}),ct(),t=i[e],t?t.p(c,l):(t=i[e]=o[e](c),t.c()),Q(t,1),t.m(r.parentNode,r))},i(c){s||(Q(t),s=!0)},o(c){ne(t),s=!1},d(c){c&&U(r),i[e].d(c)}}}function tn(){const n=window.location.href.indexOf("#/");let e=n>-1?window.location.href.substr(n+1):"/";const t=e.indexOf("?");let r="";return t>-1&&(r=e.substr(t+1),e=e.substr(0,t)),{location:e,querystring:r}}const zt=zn(null,function(e){e(tn());const t=()=>{e(tn())};return window.addEventListener("hashchange",t,!1),function(){window.removeEventListener("hashchange",t,!1)}});Pt(zt,n=>n.location);Pt(zt,n=>n.querystring);const nn=xe(void 0);function Ft(n,e){if(e=sn(e),!n||!n.tagName||n.tagName.toLowerCase()!="a")throw Error('Action "link" can only be used with <a> tags');return rn(n,e),{update(t){t=sn(t),rn(n,t)}}}function yr(n){n?window.scrollTo(n.__svelte_spa_router_scrollX,n.__svelte_spa_router_scrollY):window.scrollTo(0,0)}function rn(n,e){let t=e.href||n.getAttribute("href");if(t&&t.charAt(0)=="/")t="#"+t;else if(!t||t.length<2||t.slice(0,2)!="#/")throw Error('Invalid value for "href" attribute: '+t);n.setAttribute("href",t),n.addEventListener("click",r=>{r.preventDefault(),e.disabled||vr(r.currentTarget.getAttribute("href"))})}function sn(n){return n&&typeof n=="string"?{href:n}:n||{}}function vr(n){history.replaceState({...history.state,__svelte_spa_router_scrollX:window.scrollX,__svelte_spa_router_scrollY:window.scrollY},void 0),window.location.hash=n}function Sr(n,e,t){let{routes:r={}}=e,{prefix:s=""}=e,{restoreScrollState:o=!1}=e;class i{constructor(b,y){if(!y||typeof y!="function"&&(typeof y!="object"||y._sveltesparouter!==!0))throw Error("Invalid component object");if(!b||typeof b=="string"&&(b.length<1||b.charAt(0)!="/"&&b.charAt(0)!="*")||typeof b=="object"&&!(b instanceof RegExp))throw Error('Invalid value for "path" argument - strings must start with / or *');const{pattern:R,keys:$}=_r(b);this.path=b,typeof y=="object"&&y._sveltesparouter===!0?(this.component=y.component,this.conditions=y.conditions||[],this.userData=y.userData,this.props=y.props||{}):(this.component=()=>Promise.resolve(y),this.conditions=[],this.props={}),this._pattern=R,this._keys=$}match(b){if(s){if(typeof s=="string")if(b.startsWith(s))b=b.substr(s.length)||"/";else return null;else if(s instanceof RegExp){const O=b.match(s);if(O&&O[0])b=b.substr(O[0].length)||"/";else return null}}const y=this._pattern.exec(b);if(y===null)return null;if(this._keys===!1)return y;const R={};let $=0;for(;$<this._keys.length;){try{R[this._keys[$]]=decodeURIComponent(y[$+1]||"")||null}catch{R[this._keys[$]]=null}$++}return R}async checkConditions(b){for(let y=0;y<this.conditions.length;y++)if(!await this.conditions[y](b))return!1;return!0}}const a=[];r instanceof Map?r.forEach((S,b)=>{a.push(new i(b,S))}):Object.keys(r).forEach(S=>{a.push(new i(S,r[S]))});let c=null,l=null,h={};const f=Hn();async function p(S,b){await lr(),f(S,b)}let g=null,w=null;o&&(w=S=>{S.state&&(S.state.__svelte_spa_router_scrollY||S.state.__svelte_spa_router_scrollX)?g=S.state:g=null},window.addEventListener("popstate",w),cr(()=>{yr(g)}));let E=null,C=null;const x=zt.subscribe(async S=>{E=S;let b=0;for(;b<a.length;){const y=a[b].match(S.location);if(!y){b++;continue}const R={route:a[b].path,location:S.location,querystring:S.querystring,userData:a[b].userData,params:y&&typeof y=="object"&&Object.keys(y).length?y:null};if(!await a[b].checkConditions(R)){t(0,c=null),C=null,p("conditionsFailed",R);return}p("routeLoading",Object.assign({},R));const $=a[b].component;if(C!=$){$.loading?(t(0,c=$.loading),C=$,t(1,l=$.loadingParams),t(2,h={}),p("routeLoaded",Object.assign({},R,{component:c,name:c.name,params:l}))):(t(0,c=null),C=null);const O=await $();if(S!=E)return;t(0,c=O&&O.default||O),C=$}y&&typeof y=="object"&&Object.keys(y).length?t(1,l=y):t(1,l=null),t(2,h=a[b].props),p("routeLoaded",Object.assign({},R,{component:c,name:c.name,params:l})).then(()=>{nn.set(l)});return}t(0,c=null),C=null,nn.set(void 0)});Nn(()=>{x(),w&&window.removeEventListener("popstate",w)});function I(S){Qt.call(this,n,S)}function D(S){Qt.call(this,n,S)}return n.$$set=S=>{"routes"in S&&t(3,r=S.routes),"prefix"in S&&t(4,s=S.prefix),"restoreScrollState"in S&&t(5,o=S.restoreScrollState)},n.$$.update=()=>{n.$$.dirty&32&&(history.scrollRestoration=o?"manual":"auto")},[c,l,h,r,s,o,I,D]}class Cr extends Se{constructor(e){super(),ve(this,e,Sr,br,be,{routes:3,prefix:4,restoreScrollState:5})}}function Er(n,e,t){let r=-1;const s=Math.min(...n),o=Math.max(...n);return t===s?r=s/2:t===o?r=o+1e3:e<t?r=(kr(n.filter(a=>a!==e),t)+t)/2:e>t&&(r=(Ir(n.filter(a=>a!=e),t)+t)/2),r}function kr(n,e){let t=Number.MAX_VALUE;for(const r of n)r>e&&r<t&&(t=r);return t}function Ir(n,e){let t=Number.MIN_VALUE;for(const r of n)r<e&&r>t&&(t=r);return t}const se=xe([]),Qe=xe([]),et=xe("None"),tt=xe(!1),st=xe({header:null,message:null}),Gt=xe(!1);function Pr(n){se.update(e=>[...e,n])}function Tr(n){se.update(e=>{const t=e.find(r=>r.name===n.name);return t&&(t.amount=n.amount,t.isCollected=n.isCollected,t.unitPrice=n.unitPrice,t.order!==n.order&&(t.order=n.order,et.set("None"))),[...e]})}function xr(n){se.update(e=>e.filter(t=>t.name!==n))}function Ur(){se.set([])}function Fn(n){let e=1e3;n==="Ascending"?se.update(t=>{for(const r of t.toSorted((s,o)=>s.name.localeCompare(o.name)))r.order=e,e+=1e3;return[...t]}):se.update(t=>{for(const r of t.toSorted((s,o)=>o.name.localeCompare(s.name)))r.order=e,e+=1e3;return[...t]})}function Ar(n){st.set({header:"Info",message:n})}function ce(n){st.set({header:"Error",message:n})}function ke(n){n instanceof Error&&ce(n.message)}function Dr(){st.set({header:null,message:null})}class Rr{constructor(){H(this,"name","");H(this,"unitPrice",0)}}class on extends Rr{constructor(){super(...arguments);H(this,"amount",0);H(this,"order",0);H(this,"isCollected",!1)}}async function le(n,e,t,r){return await Gn(n,e,void 0,t,r)}async function Ke(n,e,t,r,s){return await Gn(n,e,t,r,s)}let ft="";async function Gn(n,e,t,r,s){try{const o={method:e,headers:s};if(e!=="GET"){if(!ft&&(await fetch("api/account/token",{method:"GET"})).ok){const c=document.cookie.split("; ").find(l=>l.startsWith("XSRF-TOKEN="));c&&(ft=c.split("=")[1])}ft&&(o.headers={...o.headers,"X-XSRF-TOKEN":ft})}r&&(o.body=JSON.stringify(r),o.headers={...o.headers,"Content-Type":"application/json"});const i=await fetch(n,o);return i.ok?t?await t(i):null:new Error(await i.text())}catch(o){return o instanceof Error?o:new Error("Unknown error")}}class $r{constructor(){H(this,"url","api/cartproducts/");H(this,"getCartProducts",async()=>await(await fetch(this.url)).json());H(this,"createCartProduct",async e=>await le(this.url,"POST",e));H(this,"updateCartProduct",async e=>await le(this.url,"PUT",e));H(this,"sortCartProducts",async e=>{const t=this.url+"sort/"+(e==="Ascending"?"0":"1");return await le(t,"PATCH")});H(this,"deleteAllCartProducts",async()=>await le(this.url,"DELETE"));H(this,"deleteCartProduct",async e=>await le(this.url+e,"DELETE"))}}const an="cartProducts",cn="storeProducts",Mr="preferred_username",Lr="name";class Nr{constructor(){H(this,"getCartProducts",async()=>{try{const e=localStorage.getItem(an);return e?JSON.parse(e):[]}catch(e){return e instanceof Error?e:new Error("Unknow problem loading from local storage")}});H(this,"deleteAllCartProducts",()=>this.saveCartProductsToLocalStorage());H(this,"createCartProduct",e=>this.saveCartProductsToLocalStorage());H(this,"updateCartProduct",e=>this.saveCartProductsToLocalStorage());H(this,"sortCartProducts",e=>this.saveCartProductsToLocalStorage());H(this,"deleteCartProduct",e=>this.saveCartProductsToLocalStorage())}async saveCartProductsToLocalStorage(){try{return localStorage.setItem(an,JSON.stringify(Ln(se))),null}catch(e){return e instanceof Error?e:new Error("Unknow problem saving to local storage")}}}class Hr{constructor(){H(this,"isAuthenticated",!1);H(this,"claims",[])}}let dt=null;const lt=async()=>{if(dt)return dt;const n=await Ke("api/account/user","GET",async e=>await e.json());return n instanceof Error?new Hr:(dt=n,dt)};class Me extends Error{constructor(e,t){const r=new.target.prototype;super(`${e}: Status code '${t}'`),this.statusCode=t,this.__proto__=r}}class qt extends Error{constructor(e="A timeout occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class ye extends Error{constructor(e="An abort occurred."){const t=new.target.prototype;super(e),this.__proto__=t}}class Br extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="UnsupportedTransportError",this.__proto__=r}}class Or extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="DisabledTransportError",this.__proto__=r}}class Wr extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.transport=t,this.errorType="FailedToStartTransportError",this.__proto__=r}}class ln extends Error{constructor(e){const t=new.target.prototype;super(e),this.errorType="FailedToNegotiateWithServerError",this.__proto__=t}}class zr extends Error{constructor(e,t){const r=new.target.prototype;super(e),this.innerErrors=t,this.__proto__=r}}class qn{constructor(e,t,r){this.statusCode=e,this.statusText=t,this.content=r}}class Tt{get(e,t){return this.send({...t,method:"GET",url:e})}post(e,t){return this.send({...t,method:"POST",url:e})}delete(e,t){return this.send({...t,method:"DELETE",url:e})}getCookieString(e){return""}}var m;(function(n){n[n.Trace=0]="Trace",n[n.Debug=1]="Debug",n[n.Information=2]="Information",n[n.Warning=3]="Warning",n[n.Error=4]="Error",n[n.Critical=5]="Critical",n[n.None=6]="None"})(m||(m={}));class qe{constructor(){}log(e,t){}}qe.instance=new qe;const Fr="8.0.0";class ee{static isRequired(e,t){if(e==null)throw new Error(`The '${t}' argument is required.`)}static isNotEmpty(e,t){if(!e||e.match(/^\s*$/))throw new Error(`The '${t}' argument should not be empty.`)}static isIn(e,t,r){if(!(e in t))throw new Error(`Unknown ${r} value: ${e}.`)}}class Z{static get isBrowser(){return!Z.isNode&&typeof window=="object"&&typeof window.document=="object"}static get isWebWorker(){return!Z.isNode&&typeof self=="object"&&"importScripts"in self}static get isReactNative(){return!Z.isNode&&typeof window=="object"&&typeof window.document>"u"}static get isNode(){return typeof process<"u"&&process.release&&process.release.name==="node"}}function ot(n,e){let t="";return He(n)?(t=`Binary data of length ${n.byteLength}`,e&&(t+=`. Content: '${Gr(n)}'`)):typeof n=="string"&&(t=`String data of length ${n.length}`,e&&(t+=`. Content: '${n}'`)),t}function Gr(n){const e=new Uint8Array(n);let t="";return e.forEach(r=>{const s=r<16?"0":"";t+=`0x${s}${r.toString(16)} `}),t.substr(0,t.length-1)}function He(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}async function Vn(n,e,t,r,s,o){const i={},[a,c]=Ve();i[a]=c,n.log(m.Trace,`(${e} transport) sending data. ${ot(s,o.logMessageContent)}.`);const l=He(s)?"arraybuffer":"text",h=await t.post(r,{content:s,headers:{...i,...o.headers},responseType:l,timeout:o.timeout,withCredentials:o.withCredentials});n.log(m.Trace,`(${e} transport) request complete. Response status: ${h.statusCode}.`)}function qr(n){return n===void 0?new Ct(m.Information):n===null?qe.instance:n.log!==void 0?n:new Ct(n)}class Vr{constructor(e,t){this._subject=e,this._observer=t}dispose(){const e=this._subject.observers.indexOf(this._observer);e>-1&&this._subject.observers.splice(e,1),this._subject.observers.length===0&&this._subject.cancelCallback&&this._subject.cancelCallback().catch(t=>{})}}class Ct{constructor(e){this._minLevel=e,this.out=console}log(e,t){if(e>=this._minLevel){const r=`[${new Date().toISOString()}] ${m[e]}: ${t}`;switch(e){case m.Critical:case m.Error:this.out.error(r);break;case m.Warning:this.out.warn(r);break;case m.Information:this.out.info(r);break;default:this.out.log(r);break}}}}function Ve(){let n="X-SignalR-User-Agent";return Z.isNode&&(n="User-Agent"),[n,Xr(Fr,Kr(),Jr(),jr())]}function Xr(n,e,t,r){let s="Microsoft SignalR/";const o=n.split(".");return s+=`${o[0]}.${o[1]}`,s+=` (${n}; `,e&&e!==""?s+=`${e}; `:s+="Unknown OS; ",s+=`${t}`,r?s+=`; ${r}`:s+="; Unknown Runtime Version",s+=")",s}function Kr(){if(Z.isNode)switch(process.platform){case"win32":return"Windows NT";case"darwin":return"macOS";case"linux":return"Linux";default:return process.platform}else return""}function jr(){if(Z.isNode)return process.versions.node}function Jr(){return Z.isNode?"NodeJS":"Browser"}function un(n){return n.stack?n.stack:n.message?n.message:`${n}`}function Yr(){if(typeof globalThis<"u")return globalThis;if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("could not find global")}function Zr(n){return typeof fetch>"u"||Z.isNode?(n._jar=new(require("tough-cookie")).CookieJar,typeof fetch>"u"?n._fetchType=require("node-fetch"):n._fetchType=fetch,n._fetchType=require("fetch-cookie")(n._fetchType,n._jar),!0):!1}function Qr(n){return typeof AbortController>"u"?(n._abortControllerType=require("abort-controller"),!0):!1}function es(){return require("ws")}function ts(){return require("eventsource")}class ns extends Tt{constructor(e){super(),this._logger=e;const t={_fetchType:void 0,_jar:void 0};Zr(t)?(this._fetchType=t._fetchType,this._jar=t._jar):this._fetchType=fetch.bind(Yr()),this._abortControllerType=AbortController;const r={_abortControllerType:this._abortControllerType};Qr(r)&&(this._abortControllerType=r._abortControllerType)}async send(e){if(e.abortSignal&&e.abortSignal.aborted)throw new ye;if(!e.method)throw new Error("No method defined.");if(!e.url)throw new Error("No url defined.");const t=new this._abortControllerType;let r;e.abortSignal&&(e.abortSignal.onabort=()=>{t.abort(),r=new ye});let s=null;if(e.timeout){const c=e.timeout;s=setTimeout(()=>{t.abort(),this._logger.log(m.Warning,"Timeout from HTTP request."),r=new qt},c)}e.content===""&&(e.content=void 0),e.content&&(e.headers=e.headers||{},He(e.content)?e.headers["Content-Type"]="application/octet-stream":e.headers["Content-Type"]="text/plain;charset=UTF-8");let o;try{o=await this._fetchType(e.url,{body:e.content,cache:"no-cache",credentials:e.withCredentials===!0?"include":"same-origin",headers:{"X-Requested-With":"XMLHttpRequest",...e.headers},method:e.method,mode:"cors",redirect:"follow",signal:t.signal})}catch(c){throw r||(this._logger.log(m.Warning,`Error from HTTP request. ${c}.`),c)}finally{s&&clearTimeout(s),e.abortSignal&&(e.abortSignal.onabort=null)}if(!o.ok){const c=await hn(o,"text");throw new Me(c||o.statusText,o.status)}const a=await hn(o,e.responseType);return new qn(o.status,o.statusText,a)}getCookieString(e){let t="";return Z.isNode&&this._jar&&this._jar.getCookies(e,(r,s)=>t=s.join("; ")),t}}function hn(n,e){let t;switch(e){case"arraybuffer":t=n.arrayBuffer();break;case"text":t=n.text();break;case"blob":case"document":case"json":throw new Error(`${e} is not supported.`);default:t=n.text();break}return t}class rs extends Tt{constructor(e){super(),this._logger=e}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new ye):e.method?e.url?new Promise((t,r)=>{const s=new XMLHttpRequest;s.open(e.method,e.url,!0),s.withCredentials=e.withCredentials===void 0?!0:e.withCredentials,s.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.content===""&&(e.content=void 0),e.content&&(He(e.content)?s.setRequestHeader("Content-Type","application/octet-stream"):s.setRequestHeader("Content-Type","text/plain;charset=UTF-8"));const o=e.headers;o&&Object.keys(o).forEach(i=>{s.setRequestHeader(i,o[i])}),e.responseType&&(s.responseType=e.responseType),e.abortSignal&&(e.abortSignal.onabort=()=>{s.abort(),r(new ye)}),e.timeout&&(s.timeout=e.timeout),s.onload=()=>{e.abortSignal&&(e.abortSignal.onabort=null),s.status>=200&&s.status<300?t(new qn(s.status,s.statusText,s.response||s.responseText)):r(new Me(s.response||s.responseText||s.statusText,s.status))},s.onerror=()=>{this._logger.log(m.Warning,`Error from HTTP request. ${s.status}: ${s.statusText}.`),r(new Me(s.statusText,s.status))},s.ontimeout=()=>{this._logger.log(m.Warning,"Timeout from HTTP request."),r(new qt)},s.send(e.content)}):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}}class ss extends Tt{constructor(e){if(super(),typeof fetch<"u"||Z.isNode)this._httpClient=new ns(e);else if(typeof XMLHttpRequest<"u")this._httpClient=new rs(e);else throw new Error("No usable HttpClient found.")}send(e){return e.abortSignal&&e.abortSignal.aborted?Promise.reject(new ye):e.method?e.url?this._httpClient.send(e):Promise.reject(new Error("No url defined.")):Promise.reject(new Error("No method defined."))}getCookieString(e){return this._httpClient.getCookieString(e)}}class ge{static write(e){return`${e}${ge.RecordSeparator}`}static parse(e){if(e[e.length-1]!==ge.RecordSeparator)throw new Error("Message is incomplete.");const t=e.split(ge.RecordSeparator);return t.pop(),t}}ge.RecordSeparatorCode=30;ge.RecordSeparator=String.fromCharCode(ge.RecordSeparatorCode);class os{writeHandshakeRequest(e){return ge.write(JSON.stringify(e))}parseHandshakeResponse(e){let t,r;if(He(e)){const a=new Uint8Array(e),c=a.indexOf(ge.RecordSeparatorCode);if(c===-1)throw new Error("Message is incomplete.");const l=c+1;t=String.fromCharCode.apply(null,Array.prototype.slice.call(a.slice(0,l))),r=a.byteLength>l?a.slice(l).buffer:null}else{const a=e,c=a.indexOf(ge.RecordSeparator);if(c===-1)throw new Error("Message is incomplete.");const l=c+1;t=a.substring(0,l),r=a.length>l?a.substring(l):null}const s=ge.parse(t),o=JSON.parse(s[0]);if(o.type)throw new Error("Expected a handshake response from the server.");return[r,o]}}var k;(function(n){n[n.Invocation=1]="Invocation",n[n.StreamItem=2]="StreamItem",n[n.Completion=3]="Completion",n[n.StreamInvocation=4]="StreamInvocation",n[n.CancelInvocation=5]="CancelInvocation",n[n.Ping=6]="Ping",n[n.Close=7]="Close",n[n.Ack=8]="Ack",n[n.Sequence=9]="Sequence"})(k||(k={}));class is{constructor(){this.observers=[]}next(e){for(const t of this.observers)t.next(e)}error(e){for(const t of this.observers)t.error&&t.error(e)}complete(){for(const e of this.observers)e.complete&&e.complete()}subscribe(e){return this.observers.push(e),new Vr(this,e)}}class as{constructor(e,t,r){this._bufferSize=1e5,this._messages=[],this._totalMessageCount=0,this._waitForSequenceMessage=!1,this._nextReceivingSequenceId=1,this._latestReceivedSequenceId=0,this._bufferedByteCount=0,this._reconnectInProgress=!1,this._protocol=e,this._connection=t,this._bufferSize=r}async _send(e){const t=this._protocol.writeMessage(e);let r=Promise.resolve();if(this._isInvocationMessage(e)){this._totalMessageCount++;let s=()=>{},o=()=>{};He(t)?this._bufferedByteCount+=t.byteLength:this._bufferedByteCount+=t.length,this._bufferedByteCount>=this._bufferSize&&(r=new Promise((i,a)=>{s=i,o=a})),this._messages.push(new cs(t,this._totalMessageCount,s,o))}try{this._reconnectInProgress||await this._connection.send(t)}catch{this._disconnected()}await r}_ack(e){let t=-1;for(let r=0;r<this._messages.length;r++){const s=this._messages[r];if(s._id<=e.sequenceId)t=r,He(s._message)?this._bufferedByteCount-=s._message.byteLength:this._bufferedByteCount-=s._message.length,s._resolver();else if(this._bufferedByteCount<this._bufferSize)s._resolver();else break}t!==-1&&(this._messages=this._messages.slice(t+1))}_shouldProcessMessage(e){if(this._waitForSequenceMessage)return e.type!==k.Sequence?!1:(this._waitForSequenceMessage=!1,!0);if(!this._isInvocationMessage(e))return!0;const t=this._nextReceivingSequenceId;return this._nextReceivingSequenceId++,t<=this._latestReceivedSequenceId?(t===this._latestReceivedSequenceId&&this._ackTimer(),!1):(this._latestReceivedSequenceId=t,this._ackTimer(),!0)}_resetSequence(e){if(e.sequenceId>this._nextReceivingSequenceId){this._connection.stop(new Error("Sequence ID greater than amount of messages we've received."));return}this._nextReceivingSequenceId=e.sequenceId}_disconnected(){this._reconnectInProgress=!0,this._waitForSequenceMessage=!0}async _resend(){const e=this._messages.length!==0?this._messages[0]._id:this._totalMessageCount+1;await this._connection.send(this._protocol.writeMessage({type:k.Sequence,sequenceId:e}));const t=this._messages;for(const r of t)await this._connection.send(r._message);this._reconnectInProgress=!1}_dispose(e){e??(e=new Error("Unable to reconnect to server."));for(const t of this._messages)t._rejector(e)}_isInvocationMessage(e){switch(e.type){case k.Invocation:case k.StreamItem:case k.Completion:case k.StreamInvocation:case k.CancelInvocation:return!0;case k.Close:case k.Sequence:case k.Ping:case k.Ack:return!1}}_ackTimer(){this._ackTimerHandle===void 0&&(this._ackTimerHandle=setTimeout(async()=>{try{this._reconnectInProgress||await this._connection.send(this._protocol.writeMessage({type:k.Ack,sequenceId:this._latestReceivedSequenceId}))}catch{}clearTimeout(this._ackTimerHandle),this._ackTimerHandle=void 0},1e3))}}class cs{constructor(e,t,r,s){this._message=e,this._id=t,this._resolver=r,this._rejector=s}}const ls=30*1e3,us=15*1e3,hs=1e5;var Y;(function(n){n.Disconnected="Disconnected",n.Connecting="Connecting",n.Connected="Connected",n.Disconnecting="Disconnecting",n.Reconnecting="Reconnecting"})(Y||(Y={}));class Vt{static create(e,t,r,s,o,i,a){return new Vt(e,t,r,s,o,i,a)}constructor(e,t,r,s,o,i,a){this._nextKeepAlive=0,this._freezeEventListener=()=>{this._logger.log(m.Warning,"The page is being frozen, this will likely lead to the connection being closed and messages being lost. For more information see the docs at https://learn.microsoft.com/aspnet/core/signalr/javascript-client#bsleep")},ee.isRequired(e,"connection"),ee.isRequired(t,"logger"),ee.isRequired(r,"protocol"),this.serverTimeoutInMilliseconds=o??ls,this.keepAliveIntervalInMilliseconds=i??us,this._statefulReconnectBufferSize=a??hs,this._logger=t,this._protocol=r,this.connection=e,this._reconnectPolicy=s,this._handshakeProtocol=new os,this.connection.onreceive=c=>this._processIncomingData(c),this.connection.onclose=c=>this._connectionClosed(c),this._callbacks={},this._methods={},this._closedCallbacks=[],this._reconnectingCallbacks=[],this._reconnectedCallbacks=[],this._invocationId=0,this._receivedHandshakeResponse=!1,this._connectionState=Y.Disconnected,this._connectionStarted=!1,this._cachedPingMessage=this._protocol.writeMessage({type:k.Ping})}get state(){return this._connectionState}get connectionId(){return this.connection&&this.connection.connectionId||null}get baseUrl(){return this.connection.baseUrl||""}set baseUrl(e){if(this._connectionState!==Y.Disconnected&&this._connectionState!==Y.Reconnecting)throw new Error("The HubConnection must be in the Disconnected or Reconnecting state to change the url.");if(!e)throw new Error("The HubConnection url must be a valid url.");this.connection.baseUrl=e}start(){return this._startPromise=this._startWithStateTransitions(),this._startPromise}async _startWithStateTransitions(){if(this._connectionState!==Y.Disconnected)return Promise.reject(new Error("Cannot start a HubConnection that is not in the 'Disconnected' state."));this._connectionState=Y.Connecting,this._logger.log(m.Debug,"Starting HubConnection.");try{await this._startInternal(),Z.isBrowser&&window.document.addEventListener("freeze",this._freezeEventListener),this._connectionState=Y.Connected,this._connectionStarted=!0,this._logger.log(m.Debug,"HubConnection connected successfully.")}catch(e){return this._connectionState=Y.Disconnected,this._logger.log(m.Debug,`HubConnection failed to start successfully because of error '${e}'.`),Promise.reject(e)}}async _startInternal(){this._stopDuringStartError=void 0,this._receivedHandshakeResponse=!1;const e=new Promise((t,r)=>{this._handshakeResolver=t,this._handshakeRejecter=r});await this.connection.start(this._protocol.transferFormat);try{let t=this._protocol.version;this.connection.features.reconnect||(t=1);const r={protocol:this._protocol.name,version:t};if(this._logger.log(m.Debug,"Sending handshake request."),await this._sendMessage(this._handshakeProtocol.writeHandshakeRequest(r)),this._logger.log(m.Information,`Using HubProtocol '${this._protocol.name}'.`),this._cleanupTimeout(),this._resetTimeoutPeriod(),this._resetKeepAliveInterval(),await e,this._stopDuringStartError)throw this._stopDuringStartError;(this.connection.features.reconnect||!1)&&(this._messageBuffer=new as(this._protocol,this.connection,this._statefulReconnectBufferSize),this.connection.features.disconnected=this._messageBuffer._disconnected.bind(this._messageBuffer),this.connection.features.resend=()=>{if(this._messageBuffer)return this._messageBuffer._resend()}),this.connection.features.inherentKeepAlive||await this._sendMessage(this._cachedPingMessage)}catch(t){throw this._logger.log(m.Debug,`Hub handshake failed with error '${t}' during start(). Stopping HubConnection.`),this._cleanupTimeout(),this._cleanupPingTimer(),await this.connection.stop(t),t}}async stop(){const e=this._startPromise;this.connection.features.reconnect=!1,this._stopPromise=this._stopInternal(),await this._stopPromise;try{await e}catch{}}_stopInternal(e){if(this._connectionState===Y.Disconnected)return this._logger.log(m.Debug,`Call to HubConnection.stop(${e}) ignored because it is already in the disconnected state.`),Promise.resolve();if(this._connectionState===Y.Disconnecting)return this._logger.log(m.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;const t=this._connectionState;return this._connectionState=Y.Disconnecting,this._logger.log(m.Debug,"Stopping HubConnection."),this._reconnectDelayHandle?(this._logger.log(m.Debug,"Connection stopped during reconnect delay. Done reconnecting."),clearTimeout(this._reconnectDelayHandle),this._reconnectDelayHandle=void 0,this._completeClose(),Promise.resolve()):(t===Y.Connected&&this._sendCloseMessage(),this._cleanupTimeout(),this._cleanupPingTimer(),this._stopDuringStartError=e||new ye("The connection was stopped before the hub handshake could complete."),this.connection.stop(e))}async _sendCloseMessage(){try{await this._sendWithProtocol(this._createCloseMessage())}catch{}}stream(e,...t){const[r,s]=this._replaceStreamingParams(t),o=this._createStreamInvocation(e,t,s);let i;const a=new is;return a.cancelCallback=()=>{const c=this._createCancelInvocation(o.invocationId);return delete this._callbacks[o.invocationId],i.then(()=>this._sendWithProtocol(c))},this._callbacks[o.invocationId]=(c,l)=>{if(l){a.error(l);return}else c&&(c.type===k.Completion?c.error?a.error(new Error(c.error)):a.complete():a.next(c.item))},i=this._sendWithProtocol(o).catch(c=>{a.error(c),delete this._callbacks[o.invocationId]}),this._launchStreams(r,i),a}_sendMessage(e){return this._resetKeepAliveInterval(),this.connection.send(e)}_sendWithProtocol(e){return this._messageBuffer?this._messageBuffer._send(e):this._sendMessage(this._protocol.writeMessage(e))}send(e,...t){const[r,s]=this._replaceStreamingParams(t),o=this._sendWithProtocol(this._createInvocation(e,t,!0,s));return this._launchStreams(r,o),o}invoke(e,...t){const[r,s]=this._replaceStreamingParams(t),o=this._createInvocation(e,t,!1,s);return new Promise((a,c)=>{this._callbacks[o.invocationId]=(h,f)=>{if(f){c(f);return}else h&&(h.type===k.Completion?h.error?c(new Error(h.error)):a(h.result):c(new Error(`Unexpected message type: ${h.type}`)))};const l=this._sendWithProtocol(o).catch(h=>{c(h),delete this._callbacks[o.invocationId]});this._launchStreams(r,l)})}on(e,t){!e||!t||(e=e.toLowerCase(),this._methods[e]||(this._methods[e]=[]),this._methods[e].indexOf(t)===-1&&this._methods[e].push(t))}off(e,t){if(!e)return;e=e.toLowerCase();const r=this._methods[e];if(r)if(t){const s=r.indexOf(t);s!==-1&&(r.splice(s,1),r.length===0&&delete this._methods[e])}else delete this._methods[e]}onclose(e){e&&this._closedCallbacks.push(e)}onreconnecting(e){e&&this._reconnectingCallbacks.push(e)}onreconnected(e){e&&this._reconnectedCallbacks.push(e)}_processIncomingData(e){if(this._cleanupTimeout(),this._receivedHandshakeResponse||(e=this._processHandshakeResponse(e),this._receivedHandshakeResponse=!0),e){const t=this._protocol.parseMessages(e,this._logger);for(const r of t)if(!(this._messageBuffer&&!this._messageBuffer._shouldProcessMessage(r)))switch(r.type){case k.Invocation:this._invokeClientMethod(r);break;case k.StreamItem:case k.Completion:{const s=this._callbacks[r.invocationId];if(s){r.type===k.Completion&&delete this._callbacks[r.invocationId];try{s(r)}catch(o){this._logger.log(m.Error,`Stream callback threw error: ${un(o)}`)}}break}case k.Ping:break;case k.Close:{this._logger.log(m.Information,"Close message received from server.");const s=r.error?new Error("Server returned an error on close: "+r.error):void 0;r.allowReconnect===!0?this.connection.stop(s):this._stopPromise=this._stopInternal(s);break}case k.Ack:this._messageBuffer&&this._messageBuffer._ack(r);break;case k.Sequence:this._messageBuffer&&this._messageBuffer._resetSequence(r);break;default:this._logger.log(m.Warning,`Invalid message type: ${r.type}.`);break}}this._resetTimeoutPeriod()}_processHandshakeResponse(e){let t,r;try{[r,t]=this._handshakeProtocol.parseHandshakeResponse(e)}catch(s){const o="Error parsing handshake response: "+s;this._logger.log(m.Error,o);const i=new Error(o);throw this._handshakeRejecter(i),i}if(t.error){const s="Server returned handshake error: "+t.error;this._logger.log(m.Error,s);const o=new Error(s);throw this._handshakeRejecter(o),o}else this._logger.log(m.Debug,"Server handshake complete.");return this._handshakeResolver(),r}_resetKeepAliveInterval(){this.connection.features.inherentKeepAlive||(this._nextKeepAlive=new Date().getTime()+this.keepAliveIntervalInMilliseconds,this._cleanupPingTimer())}_resetTimeoutPeriod(){if((!this.connection.features||!this.connection.features.inherentKeepAlive)&&(this._timeoutHandle=setTimeout(()=>this.serverTimeout(),this.serverTimeoutInMilliseconds),this._pingServerHandle===void 0)){let e=this._nextKeepAlive-new Date().getTime();e<0&&(e=0),this._pingServerHandle=setTimeout(async()=>{if(this._connectionState===Y.Connected)try{await this._sendMessage(this._cachedPingMessage)}catch{this._cleanupPingTimer()}},e)}}serverTimeout(){this.connection.stop(new Error("Server timeout elapsed without receiving a message from the server."))}async _invokeClientMethod(e){const t=e.target.toLowerCase(),r=this._methods[t];if(!r){this._logger.log(m.Warning,`No client method with the name '${t}' found.`),e.invocationId&&(this._logger.log(m.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),await this._sendWithProtocol(this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)));return}const s=r.slice(),o=!!e.invocationId;let i,a,c;for(const l of s)try{const h=i;i=await l.apply(this,e.arguments),o&&i&&h&&(this._logger.log(m.Error,`Multiple results provided for '${t}'. Sending error to server.`),c=this._createCompletionMessage(e.invocationId,"Client provided multiple results.",null)),a=void 0}catch(h){a=h,this._logger.log(m.Error,`A callback for the method '${t}' threw error '${h}'.`)}c?await this._sendWithProtocol(c):o?(a?c=this._createCompletionMessage(e.invocationId,`${a}`,null):i!==void 0?c=this._createCompletionMessage(e.invocationId,null,i):(this._logger.log(m.Warning,`No result given for '${t}' method and invocation ID '${e.invocationId}'.`),c=this._createCompletionMessage(e.invocationId,"Client didn't provide a result.",null)),await this._sendWithProtocol(c)):i&&this._logger.log(m.Error,`Result given for '${t}' method but server is not expecting a result.`)}_connectionClosed(e){this._logger.log(m.Debug,`HubConnection.connectionClosed(${e}) called while in state ${this._connectionState}.`),this._stopDuringStartError=this._stopDuringStartError||e||new ye("The underlying connection was closed before the hub handshake could complete."),this._handshakeResolver&&this._handshakeResolver(),this._cancelCallbacksWithError(e||new Error("Invocation canceled due to the underlying connection being closed.")),this._cleanupTimeout(),this._cleanupPingTimer(),this._connectionState===Y.Disconnecting?this._completeClose(e):this._connectionState===Y.Connected&&this._reconnectPolicy?this._reconnect(e):this._connectionState===Y.Connected&&this._completeClose(e)}_completeClose(e){if(this._connectionStarted){this._connectionState=Y.Disconnected,this._connectionStarted=!1,this._messageBuffer&&(this._messageBuffer._dispose(e??new Error("Connection closed.")),this._messageBuffer=void 0),Z.isBrowser&&window.document.removeEventListener("freeze",this._freezeEventListener);try{this._closedCallbacks.forEach(t=>t.apply(this,[e]))}catch(t){this._logger.log(m.Error,`An onclose callback called with error '${e}' threw error '${t}'.`)}}}async _reconnect(e){const t=Date.now();let r=0,s=e!==void 0?e:new Error("Attempting to reconnect due to a unknown error."),o=this._getNextRetryDelay(r++,0,s);if(o===null){this._logger.log(m.Debug,"Connection not reconnecting because the IRetryPolicy returned null on the first reconnect attempt."),this._completeClose(e);return}if(this._connectionState=Y.Reconnecting,e?this._logger.log(m.Information,`Connection reconnecting because of error '${e}'.`):this._logger.log(m.Information,"Connection reconnecting."),this._reconnectingCallbacks.length!==0){try{this._reconnectingCallbacks.forEach(i=>i.apply(this,[e]))}catch(i){this._logger.log(m.Error,`An onreconnecting callback called with error '${e}' threw error '${i}'.`)}if(this._connectionState!==Y.Reconnecting){this._logger.log(m.Debug,"Connection left the reconnecting state in onreconnecting callback. Done reconnecting.");return}}for(;o!==null;){if(this._logger.log(m.Information,`Reconnect attempt number ${r} will start in ${o} ms.`),await new Promise(i=>{this._reconnectDelayHandle=setTimeout(i,o)}),this._reconnectDelayHandle=void 0,this._connectionState!==Y.Reconnecting){this._logger.log(m.Debug,"Connection left the reconnecting state during reconnect delay. Done reconnecting.");return}try{if(await this._startInternal(),this._connectionState=Y.Connected,this._logger.log(m.Information,"HubConnection reconnected successfully."),this._reconnectedCallbacks.length!==0)try{this._reconnectedCallbacks.forEach(i=>i.apply(this,[this.connection.connectionId]))}catch(i){this._logger.log(m.Error,`An onreconnected callback called with connectionId '${this.connection.connectionId}; threw error '${i}'.`)}return}catch(i){if(this._logger.log(m.Information,`Reconnect attempt failed because of error '${i}'.`),this._connectionState!==Y.Reconnecting){this._logger.log(m.Debug,`Connection moved to the '${this._connectionState}' from the reconnecting state during reconnect attempt. Done reconnecting.`),this._connectionState===Y.Disconnecting&&this._completeClose();return}s=i instanceof Error?i:new Error(i.toString()),o=this._getNextRetryDelay(r++,Date.now()-t,s)}}this._logger.log(m.Information,`Reconnect retries have been exhausted after ${Date.now()-t} ms and ${r} failed attempts. Connection disconnecting.`),this._completeClose()}_getNextRetryDelay(e,t,r){try{return this._reconnectPolicy.nextRetryDelayInMilliseconds({elapsedMilliseconds:t,previousRetryCount:e,retryReason:r})}catch(s){return this._logger.log(m.Error,`IRetryPolicy.nextRetryDelayInMilliseconds(${e}, ${t}) threw error '${s}'.`),null}}_cancelCallbacksWithError(e){const t=this._callbacks;this._callbacks={},Object.keys(t).forEach(r=>{const s=t[r];try{s(null,e)}catch(o){this._logger.log(m.Error,`Stream 'error' callback called with '${e}' threw error: ${un(o)}`)}})}_cleanupPingTimer(){this._pingServerHandle&&(clearTimeout(this._pingServerHandle),this._pingServerHandle=void 0)}_cleanupTimeout(){this._timeoutHandle&&clearTimeout(this._timeoutHandle)}_createInvocation(e,t,r,s){if(r)return s.length!==0?{arguments:t,streamIds:s,target:e,type:k.Invocation}:{arguments:t,target:e,type:k.Invocation};{const o=this._invocationId;return this._invocationId++,s.length!==0?{arguments:t,invocationId:o.toString(),streamIds:s,target:e,type:k.Invocation}:{arguments:t,invocationId:o.toString(),target:e,type:k.Invocation}}}_launchStreams(e,t){if(e.length!==0){t||(t=Promise.resolve());for(const r in e)e[r].subscribe({complete:()=>{t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(r)))},error:s=>{let o;s instanceof Error?o=s.message:s&&s.toString?o=s.toString():o="Unknown error",t=t.then(()=>this._sendWithProtocol(this._createCompletionMessage(r,o)))},next:s=>{t=t.then(()=>this._sendWithProtocol(this._createStreamItemMessage(r,s)))}})}}_replaceStreamingParams(e){const t=[],r=[];for(let s=0;s<e.length;s++){const o=e[s];if(this._isObservable(o)){const i=this._invocationId;this._invocationId++,t[i]=o,r.push(i.toString()),e.splice(s,1)}}return[t,r]}_isObservable(e){return e&&e.subscribe&&typeof e.subscribe=="function"}_createStreamInvocation(e,t,r){const s=this._invocationId;return this._invocationId++,r.length!==0?{arguments:t,invocationId:s.toString(),streamIds:r,target:e,type:k.StreamInvocation}:{arguments:t,invocationId:s.toString(),target:e,type:k.StreamInvocation}}_createCancelInvocation(e){return{invocationId:e,type:k.CancelInvocation}}_createStreamItemMessage(e,t){return{invocationId:e,item:t,type:k.StreamItem}}_createCompletionMessage(e,t,r){return t?{error:t,invocationId:e,type:k.Completion}:{invocationId:e,result:r,type:k.Completion}}_createCloseMessage(){return{type:k.Close}}}const fs=[0,2e3,1e4,3e4,null];class fn{constructor(e){this._retryDelays=e!==void 0?[...e,null]:fs}nextRetryDelayInMilliseconds(e){return this._retryDelays[e.previousRetryCount]}}class Le{}Le.Authorization="Authorization";Le.Cookie="Cookie";class ds extends Tt{constructor(e,t){super(),this._innerClient=e,this._accessTokenFactory=t}async send(e){let t=!0;this._accessTokenFactory&&(!this._accessToken||e.url&&e.url.indexOf("/negotiate?")>0)&&(t=!1,this._accessToken=await this._accessTokenFactory()),this._setAuthorizationHeader(e);const r=await this._innerClient.send(e);return t&&r.statusCode===401&&this._accessTokenFactory?(this._accessToken=await this._accessTokenFactory(),this._setAuthorizationHeader(e),await this._innerClient.send(e)):r}_setAuthorizationHeader(e){e.headers||(e.headers={}),this._accessToken?e.headers[Le.Authorization]=`Bearer ${this._accessToken}`:this._accessTokenFactory&&e.headers[Le.Authorization]&&delete e.headers[Le.Authorization]}getCookieString(e){return this._innerClient.getCookieString(e)}}var re;(function(n){n[n.None=0]="None",n[n.WebSockets=1]="WebSockets",n[n.ServerSentEvents=2]="ServerSentEvents",n[n.LongPolling=4]="LongPolling"})(re||(re={}));var oe;(function(n){n[n.Text=1]="Text",n[n.Binary=2]="Binary"})(oe||(oe={}));let ps=class{constructor(){this._isAborted=!1,this.onabort=null}abort(){this._isAborted||(this._isAborted=!0,this.onabort&&this.onabort())}get signal(){return this}get aborted(){return this._isAborted}};class dn{get pollAborted(){return this._pollAbort.aborted}constructor(e,t,r){this._httpClient=e,this._logger=t,this._pollAbort=new ps,this._options=r,this._running=!1,this.onreceive=null,this.onclose=null}async connect(e,t){if(ee.isRequired(e,"url"),ee.isRequired(t,"transferFormat"),ee.isIn(t,oe,"transferFormat"),this._url=e,this._logger.log(m.Trace,"(LongPolling transport) Connecting."),t===oe.Binary&&typeof XMLHttpRequest<"u"&&typeof new XMLHttpRequest().responseType!="string")throw new Error("Binary protocols over XmlHttpRequest not implementing advanced features are not supported.");const[r,s]=Ve(),o={[r]:s,...this._options.headers},i={abortSignal:this._pollAbort.signal,headers:o,timeout:1e5,withCredentials:this._options.withCredentials};t===oe.Binary&&(i.responseType="arraybuffer");const a=`${e}&_=${Date.now()}`;this._logger.log(m.Trace,`(LongPolling transport) polling: ${a}.`);const c=await this._httpClient.get(a,i);c.statusCode!==200?(this._logger.log(m.Error,`(LongPolling transport) Unexpected response code: ${c.statusCode}.`),this._closeError=new Me(c.statusText||"",c.statusCode),this._running=!1):this._running=!0,this._receiving=this._poll(this._url,i)}async _poll(e,t){try{for(;this._running;)try{const r=`${e}&_=${Date.now()}`;this._logger.log(m.Trace,`(LongPolling transport) polling: ${r}.`);const s=await this._httpClient.get(r,t);s.statusCode===204?(this._logger.log(m.Information,"(LongPolling transport) Poll terminated by server."),this._running=!1):s.statusCode!==200?(this._logger.log(m.Error,`(LongPolling transport) Unexpected response code: ${s.statusCode}.`),this._closeError=new Me(s.statusText||"",s.statusCode),this._running=!1):s.content?(this._logger.log(m.Trace,`(LongPolling transport) data received. ${ot(s.content,this._options.logMessageContent)}.`),this.onreceive&&this.onreceive(s.content)):this._logger.log(m.Trace,"(LongPolling transport) Poll timed out, reissuing.")}catch(r){this._running?r instanceof qt?this._logger.log(m.Trace,"(LongPolling transport) Poll timed out, reissuing."):(this._closeError=r,this._running=!1):this._logger.log(m.Trace,`(LongPolling transport) Poll errored after shutdown: ${r.message}`)}}finally{this._logger.log(m.Trace,"(LongPolling transport) Polling complete."),this.pollAborted||this._raiseOnClose()}}async send(e){return this._running?Vn(this._logger,"LongPolling",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}async stop(){this._logger.log(m.Trace,"(LongPolling transport) Stopping polling."),this._running=!1,this._pollAbort.abort();try{await this._receiving,this._logger.log(m.Trace,`(LongPolling transport) sending DELETE request to ${this._url}.`);const e={},[t,r]=Ve();e[t]=r;const s={headers:{...e,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials};let o;try{await this._httpClient.delete(this._url,s)}catch(i){o=i}o?o instanceof Me&&(o.statusCode===404?this._logger.log(m.Trace,"(LongPolling transport) A 404 response was returned from sending a DELETE request."):this._logger.log(m.Trace,`(LongPolling transport) Error sending a DELETE request: ${o}`)):this._logger.log(m.Trace,"(LongPolling transport) DELETE request accepted.")}finally{this._logger.log(m.Trace,"(LongPolling transport) Stop finished."),this._raiseOnClose()}}_raiseOnClose(){if(this.onclose){let e="(LongPolling transport) Firing onclose event.";this._closeError&&(e+=" Error: "+this._closeError),this._logger.log(m.Trace,e),this.onclose(this._closeError)}}}class gs{constructor(e,t,r,s){this._httpClient=e,this._accessToken=t,this._logger=r,this._options=s,this.onreceive=null,this.onclose=null}async connect(e,t){return ee.isRequired(e,"url"),ee.isRequired(t,"transferFormat"),ee.isIn(t,oe,"transferFormat"),this._logger.log(m.Trace,"(SSE transport) Connecting."),this._url=e,this._accessToken&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(this._accessToken)}`),new Promise((r,s)=>{let o=!1;if(t!==oe.Text){s(new Error("The Server-Sent Events transport only supports the 'Text' transfer format"));return}let i;if(Z.isBrowser||Z.isWebWorker)i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials});else{const a=this._httpClient.getCookieString(e),c={};c.Cookie=a;const[l,h]=Ve();c[l]=h,i=new this._options.EventSource(e,{withCredentials:this._options.withCredentials,headers:{...c,...this._options.headers}})}try{i.onmessage=a=>{if(this.onreceive)try{this._logger.log(m.Trace,`(SSE transport) data received. ${ot(a.data,this._options.logMessageContent)}.`),this.onreceive(a.data)}catch(c){this._close(c);return}},i.onerror=a=>{o?this._close():s(new Error("EventSource failed to connect. The connection could not be found on the server, either the connection ID is not present on the server, or a proxy is refusing/buffering the connection. If you have multiple servers check that sticky sessions are enabled."))},i.onopen=()=>{this._logger.log(m.Information,`SSE connected to ${this._url}`),this._eventSource=i,o=!0,r()}}catch(a){s(a);return}})}async send(e){return this._eventSource?Vn(this._logger,"SSE",this._httpClient,this._url,e,this._options):Promise.reject(new Error("Cannot send until the transport is connected"))}stop(){return this._close(),Promise.resolve()}_close(e){this._eventSource&&(this._eventSource.close(),this._eventSource=void 0,this.onclose&&this.onclose(e))}}class _s{constructor(e,t,r,s,o,i){this._logger=r,this._accessTokenFactory=t,this._logMessageContent=s,this._webSocketConstructor=o,this._httpClient=e,this.onreceive=null,this.onclose=null,this._headers=i}async connect(e,t){ee.isRequired(e,"url"),ee.isRequired(t,"transferFormat"),ee.isIn(t,oe,"transferFormat"),this._logger.log(m.Trace,"(WebSockets transport) Connecting.");let r;return this._accessTokenFactory&&(r=await this._accessTokenFactory()),new Promise((s,o)=>{e=e.replace(/^http/,"ws");let i;const a=this._httpClient.getCookieString(e);let c=!1;if(Z.isNode||Z.isReactNative){const l={},[h,f]=Ve();l[h]=f,r&&(l[Le.Authorization]=`Bearer ${r}`),a&&(l[Le.Cookie]=a),i=new this._webSocketConstructor(e,void 0,{headers:{...l,...this._headers}})}else r&&(e+=(e.indexOf("?")<0?"?":"&")+`access_token=${encodeURIComponent(r)}`);i||(i=new this._webSocketConstructor(e)),t===oe.Binary&&(i.binaryType="arraybuffer"),i.onopen=l=>{this._logger.log(m.Information,`WebSocket connected to ${e}.`),this._webSocket=i,c=!0,s()},i.onerror=l=>{let h=null;typeof ErrorEvent<"u"&&l instanceof ErrorEvent?h=l.error:h="There was an error with the transport",this._logger.log(m.Information,`(WebSockets transport) ${h}.`)},i.onmessage=l=>{if(this._logger.log(m.Trace,`(WebSockets transport) data received. ${ot(l.data,this._logMessageContent)}.`),this.onreceive)try{this.onreceive(l.data)}catch(h){this._close(h);return}},i.onclose=l=>{if(c)this._close(l);else{let h=null;typeof ErrorEvent<"u"&&l instanceof ErrorEvent?h=l.error:h="WebSocket failed to connect. The connection could not be found on the server, either the endpoint may not be a SignalR endpoint, the connection ID is not present on the server, or there is a proxy blocking WebSockets. If you have multiple servers check that sticky sessions are enabled.",o(new Error(h))}}})}send(e){return this._webSocket&&this._webSocket.readyState===this._webSocketConstructor.OPEN?(this._logger.log(m.Trace,`(WebSockets transport) sending data. ${ot(e,this._logMessageContent)}.`),this._webSocket.send(e),Promise.resolve()):Promise.reject("WebSocket is not in the OPEN state")}stop(){return this._webSocket&&this._close(void 0),Promise.resolve()}_close(e){this._webSocket&&(this._webSocket.onclose=()=>{},this._webSocket.onmessage=()=>{},this._webSocket.onerror=()=>{},this._webSocket.close(),this._webSocket=void 0),this._logger.log(m.Trace,"(WebSockets transport) socket closed."),this.onclose&&(this._isCloseEvent(e)&&(e.wasClean===!1||e.code!==1e3)?this.onclose(new Error(`WebSocket closed with status code: ${e.code} (${e.reason||"no reason given"}).`)):e instanceof Error?this.onclose(e):this.onclose())}_isCloseEvent(e){return e&&typeof e.wasClean=="boolean"&&typeof e.code=="number"}}const pn=100;class ms{constructor(e,t={}){if(this._stopPromiseResolver=()=>{},this.features={},this._negotiateVersion=1,ee.isRequired(e,"url"),this._logger=qr(t.logger),this.baseUrl=this._resolveUrl(e),t=t||{},t.logMessageContent=t.logMessageContent===void 0?!1:t.logMessageContent,typeof t.withCredentials=="boolean"||t.withCredentials===void 0)t.withCredentials=t.withCredentials===void 0?!0:t.withCredentials;else throw new Error("withCredentials option was not a 'boolean' or 'undefined' value");t.timeout=t.timeout===void 0?100*1e3:t.timeout;let r=null,s=null;Z.isNode&&typeof require<"u"&&(r=es(),s=ts()),!Z.isNode&&typeof WebSocket<"u"&&!t.WebSocket?t.WebSocket=WebSocket:Z.isNode&&!t.WebSocket&&r&&(t.WebSocket=r),!Z.isNode&&typeof EventSource<"u"&&!t.EventSource?t.EventSource=EventSource:Z.isNode&&!t.EventSource&&typeof s<"u"&&(t.EventSource=s),this._httpClient=new ds(t.httpClient||new ss(this._logger),t.accessTokenFactory),this._connectionState="Disconnected",this._connectionStarted=!1,this._options=t,this.onreceive=null,this.onclose=null}async start(e){if(e=e||oe.Binary,ee.isIn(e,oe,"transferFormat"),this._logger.log(m.Debug,`Starting connection with transfer format '${oe[e]}'.`),this._connectionState!=="Disconnected")return Promise.reject(new Error("Cannot start an HttpConnection that is not in the 'Disconnected' state."));if(this._connectionState="Connecting",this._startInternalPromise=this._startInternal(e),await this._startInternalPromise,this._connectionState==="Disconnecting"){const t="Failed to start the HttpConnection before stop() was called.";return this._logger.log(m.Error,t),await this._stopPromise,Promise.reject(new ye(t))}else if(this._connectionState!=="Connected"){const t="HttpConnection.startInternal completed gracefully but didn't enter the connection into the connected state!";return this._logger.log(m.Error,t),Promise.reject(new ye(t))}this._connectionStarted=!0}send(e){return this._connectionState!=="Connected"?Promise.reject(new Error("Cannot send data if the connection is not in the 'Connected' State.")):(this._sendQueue||(this._sendQueue=new Xt(this.transport)),this._sendQueue.send(e))}async stop(e){if(this._connectionState==="Disconnected")return this._logger.log(m.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnected state.`),Promise.resolve();if(this._connectionState==="Disconnecting")return this._logger.log(m.Debug,`Call to HttpConnection.stop(${e}) ignored because the connection is already in the disconnecting state.`),this._stopPromise;this._connectionState="Disconnecting",this._stopPromise=new Promise(t=>{this._stopPromiseResolver=t}),await this._stopInternal(e),await this._stopPromise}async _stopInternal(e){this._stopError=e;try{await this._startInternalPromise}catch{}if(this.transport){try{await this.transport.stop()}catch(t){this._logger.log(m.Error,`HttpConnection.transport.stop() threw error '${t}'.`),this._stopConnection()}this.transport=void 0}else this._logger.log(m.Debug,"HttpConnection.transport is undefined in HttpConnection.stop() because start() failed.")}async _startInternal(e){let t=this.baseUrl;this._accessTokenFactory=this._options.accessTokenFactory,this._httpClient._accessTokenFactory=this._accessTokenFactory;try{if(this._options.skipNegotiation)if(this._options.transport===re.WebSockets)this.transport=this._constructTransport(re.WebSockets),await this._startTransport(t,e);else throw new Error("Negotiation can only be skipped when using the WebSocket transport directly.");else{let r=null,s=0;do{if(r=await this._getNegotiationResponse(t),this._connectionState==="Disconnecting"||this._connectionState==="Disconnected")throw new ye("The connection was stopped during negotiation.");if(r.error)throw new Error(r.error);if(r.ProtocolVersion)throw new Error("Detected a connection attempt to an ASP.NET SignalR Server. This client only supports connecting to an ASP.NET Core SignalR Server. See https://aka.ms/signalr-core-differences for details.");if(r.url&&(t=r.url),r.accessToken){const o=r.accessToken;this._accessTokenFactory=()=>o,this._httpClient._accessToken=o,this._httpClient._accessTokenFactory=void 0}s++}while(r.url&&s<pn);if(s===pn&&r.url)throw new Error("Negotiate redirection limit exceeded.");await this._createTransport(t,this._options.transport,r,e)}this.transport instanceof dn&&(this.features.inherentKeepAlive=!0),this._connectionState==="Connecting"&&(this._logger.log(m.Debug,"The HttpConnection connected successfully."),this._connectionState="Connected")}catch(r){return this._logger.log(m.Error,"Failed to start the connection: "+r),this._connectionState="Disconnected",this.transport=void 0,this._stopPromiseResolver(),Promise.reject(r)}}async _getNegotiationResponse(e){const t={},[r,s]=Ve();t[r]=s;const o=this._resolveNegotiateUrl(e);this._logger.log(m.Debug,`Sending negotiation request: ${o}.`);try{const i=await this._httpClient.post(o,{content:"",headers:{...t,...this._options.headers},timeout:this._options.timeout,withCredentials:this._options.withCredentials});if(i.statusCode!==200)return Promise.reject(new Error(`Unexpected status code returned from negotiate '${i.statusCode}'`));const a=JSON.parse(i.content);return(!a.negotiateVersion||a.negotiateVersion<1)&&(a.connectionToken=a.connectionId),a.useStatefulReconnect&&this._options._useStatefulReconnect!==!0?Promise.reject(new ln("Client didn't negotiate Stateful Reconnect but the server did.")):a}catch(i){let a="Failed to complete negotiation with the server: "+i;return i instanceof Me&&i.statusCode===404&&(a=a+" Either this is not a SignalR endpoint or there is a proxy blocking the connection."),this._logger.log(m.Error,a),Promise.reject(new ln(a))}}_createConnectUrl(e,t){return t?e+(e.indexOf("?")===-1?"?":"&")+`id=${t}`:e}async _createTransport(e,t,r,s){let o=this._createConnectUrl(e,r.connectionToken);if(this._isITransport(t)){this._logger.log(m.Debug,"Connection was provided an instance of ITransport, using that directly."),this.transport=t,await this._startTransport(o,s),this.connectionId=r.connectionId;return}const i=[],a=r.availableTransports||[];let c=r;for(const l of a){const h=this._resolveTransportOrError(l,t,s,(c==null?void 0:c.useStatefulReconnect)===!0);if(h instanceof Error)i.push(`${l.transport} failed:`),i.push(h);else if(this._isITransport(h)){if(this.transport=h,!c){try{c=await this._getNegotiationResponse(e)}catch(f){return Promise.reject(f)}o=this._createConnectUrl(e,c.connectionToken)}try{await this._startTransport(o,s),this.connectionId=c.connectionId;return}catch(f){if(this._logger.log(m.Error,`Failed to start the transport '${l.transport}': ${f}`),c=void 0,i.push(new Wr(`${l.transport} failed: ${f}`,re[l.transport])),this._connectionState!=="Connecting"){const p="Failed to select transport before stop() was called.";return this._logger.log(m.Debug,p),Promise.reject(new ye(p))}}}}return i.length>0?Promise.reject(new zr(`Unable to connect to the server with any of the available transports. ${i.join(" ")}`,i)):Promise.reject(new Error("None of the transports supported by the client are supported by the server."))}_constructTransport(e){switch(e){case re.WebSockets:if(!this._options.WebSocket)throw new Error("'WebSocket' is not supported in your environment.");return new _s(this._httpClient,this._accessTokenFactory,this._logger,this._options.logMessageContent,this._options.WebSocket,this._options.headers||{});case re.ServerSentEvents:if(!this._options.EventSource)throw new Error("'EventSource' is not supported in your environment.");return new gs(this._httpClient,this._httpClient._accessToken,this._logger,this._options);case re.LongPolling:return new dn(this._httpClient,this._logger,this._options);default:throw new Error(`Unknown transport: ${e}.`)}}_startTransport(e,t){return this.transport.onreceive=this.onreceive,this.features.reconnect?this.transport.onclose=async r=>{let s=!1;if(this.features.reconnect)try{this.features.disconnected(),await this.transport.connect(e,t),await this.features.resend()}catch{s=!0}else{this._stopConnection(r);return}s&&this._stopConnection(r)}:this.transport.onclose=r=>this._stopConnection(r),this.transport.connect(e,t)}_resolveTransportOrError(e,t,r,s){const o=re[e.transport];if(o==null)return this._logger.log(m.Debug,`Skipping transport '${e.transport}' because it is not supported by this client.`),new Error(`Skipping transport '${e.transport}' because it is not supported by this client.`);if(ws(t,o))if(e.transferFormats.map(a=>oe[a]).indexOf(r)>=0){if(o===re.WebSockets&&!this._options.WebSocket||o===re.ServerSentEvents&&!this._options.EventSource)return this._logger.log(m.Debug,`Skipping transport '${re[o]}' because it is not supported in your environment.'`),new Br(`'${re[o]}' is not supported in your environment.`,o);this._logger.log(m.Debug,`Selecting transport '${re[o]}'.`);try{return this.features.reconnect=o===re.WebSockets?s:void 0,this._constructTransport(o)}catch(a){return a}}else return this._logger.log(m.Debug,`Skipping transport '${re[o]}' because it does not support the requested transfer format '${oe[r]}'.`),new Error(`'${re[o]}' does not support ${oe[r]}.`);else return this._logger.log(m.Debug,`Skipping transport '${re[o]}' because it was disabled by the client.`),new Or(`'${re[o]}' is disabled by the client.`,o)}_isITransport(e){return e&&typeof e=="object"&&"connect"in e}_stopConnection(e){if(this._logger.log(m.Debug,`HttpConnection.stopConnection(${e}) called while in state ${this._connectionState}.`),this.transport=void 0,e=this._stopError||e,this._stopError=void 0,this._connectionState==="Disconnected"){this._logger.log(m.Debug,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is already in the disconnected state.`);return}if(this._connectionState==="Connecting")throw this._logger.log(m.Warning,`Call to HttpConnection.stopConnection(${e}) was ignored because the connection is still in the connecting state.`),new Error(`HttpConnection.stopConnection(${e}) was called while the connection is still in the connecting state.`);if(this._connectionState==="Disconnecting"&&this._stopPromiseResolver(),e?this._logger.log(m.Error,`Connection disconnected with error '${e}'.`):this._logger.log(m.Information,"Connection disconnected."),this._sendQueue&&(this._sendQueue.stop().catch(t=>{this._logger.log(m.Error,`TransportSendQueue.stop() threw error '${t}'.`)}),this._sendQueue=void 0),this.connectionId=void 0,this._connectionState="Disconnected",this._connectionStarted){this._connectionStarted=!1;try{this.onclose&&this.onclose(e)}catch(t){this._logger.log(m.Error,`HttpConnection.onclose(${e}) threw error '${t}'.`)}}}_resolveUrl(e){if(e.lastIndexOf("https://",0)===0||e.lastIndexOf("http://",0)===0)return e;if(!Z.isBrowser)throw new Error(`Cannot resolve '${e}'.`);const t=window.document.createElement("a");return t.href=e,this._logger.log(m.Information,`Normalizing '${e}' to '${t.href}'.`),t.href}_resolveNegotiateUrl(e){const t=new URL(e);t.pathname.endsWith("/")?t.pathname+="negotiate":t.pathname+="/negotiate";const r=new URLSearchParams(t.searchParams);return r.has("negotiateVersion")||r.append("negotiateVersion",this._negotiateVersion.toString()),r.has("useStatefulReconnect")?r.get("useStatefulReconnect")==="true"&&(this._options._useStatefulReconnect=!0):this._options._useStatefulReconnect===!0&&r.append("useStatefulReconnect","true"),t.search=r.toString(),t.toString()}}function ws(n,e){return!n||(e&n)!==0}class Xt{constructor(e){this._transport=e,this._buffer=[],this._executing=!0,this._sendBufferedData=new pt,this._transportResult=new pt,this._sendLoopPromise=this._sendLoop()}send(e){return this._bufferData(e),this._transportResult||(this._transportResult=new pt),this._transportResult.promise}stop(){return this._executing=!1,this._sendBufferedData.resolve(),this._sendLoopPromise}_bufferData(e){if(this._buffer.length&&typeof this._buffer[0]!=typeof e)throw new Error(`Expected data to be of type ${typeof this._buffer} but was of type ${typeof e}`);this._buffer.push(e),this._sendBufferedData.resolve()}async _sendLoop(){for(;;){if(await this._sendBufferedData.promise,!this._executing){this._transportResult&&this._transportResult.reject("Connection stopped.");break}this._sendBufferedData=new pt;const e=this._transportResult;this._transportResult=void 0;const t=typeof this._buffer[0]=="string"?this._buffer.join(""):Xt._concatBuffers(this._buffer);this._buffer.length=0;try{await this._transport.send(t),e.resolve()}catch(r){e.reject(r)}}}static _concatBuffers(e){const t=e.map(o=>o.byteLength).reduce((o,i)=>o+i),r=new Uint8Array(t);let s=0;for(const o of e)r.set(new Uint8Array(o),s),s+=o.byteLength;return r.buffer}}class pt{constructor(){this.promise=new Promise((e,t)=>[this._resolver,this._rejecter]=[e,t])}resolve(){this._resolver()}reject(e){this._rejecter(e)}}const bs="json";class ys{constructor(){this.name=bs,this.version=2,this.transferFormat=oe.Text}parseMessages(e,t){if(typeof e!="string")throw new Error("Invalid input for JSON hub protocol. Expected a string.");if(!e)return[];t===null&&(t=qe.instance);const r=ge.parse(e),s=[];for(const o of r){const i=JSON.parse(o);if(typeof i.type!="number")throw new Error("Invalid payload.");switch(i.type){case k.Invocation:this._isInvocationMessage(i);break;case k.StreamItem:this._isStreamItemMessage(i);break;case k.Completion:this._isCompletionMessage(i);break;case k.Ping:break;case k.Close:break;case k.Ack:this._isAckMessage(i);break;case k.Sequence:this._isSequenceMessage(i);break;default:t.log(m.Information,"Unknown message type '"+i.type+"' ignored.");continue}s.push(i)}return s}writeMessage(e){return ge.write(JSON.stringify(e))}_isInvocationMessage(e){this._assertNotEmptyString(e.target,"Invalid payload for Invocation message."),e.invocationId!==void 0&&this._assertNotEmptyString(e.invocationId,"Invalid payload for Invocation message.")}_isStreamItemMessage(e){if(this._assertNotEmptyString(e.invocationId,"Invalid payload for StreamItem message."),e.item===void 0)throw new Error("Invalid payload for StreamItem message.")}_isCompletionMessage(e){if(e.result&&e.error)throw new Error("Invalid payload for Completion message.");!e.result&&e.error&&this._assertNotEmptyString(e.error,"Invalid payload for Completion message."),this._assertNotEmptyString(e.invocationId,"Invalid payload for Completion message.")}_isAckMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Ack message.")}_isSequenceMessage(e){if(typeof e.sequenceId!="number")throw new Error("Invalid SequenceId for Sequence message.")}_assertNotEmptyString(e,t){if(typeof e!="string"||e==="")throw new Error(t)}}const vs={trace:m.Trace,debug:m.Debug,info:m.Information,information:m.Information,warn:m.Warning,warning:m.Warning,error:m.Error,critical:m.Critical,none:m.None};function Ss(n){const e=vs[n.toLowerCase()];if(typeof e<"u")return e;throw new Error(`Unknown log level: ${n}`)}class Cs{configureLogging(e){if(ee.isRequired(e,"logging"),Es(e))this.logger=e;else if(typeof e=="string"){const t=Ss(e);this.logger=new Ct(t)}else this.logger=new Ct(e);return this}withUrl(e,t){return ee.isRequired(e,"url"),ee.isNotEmpty(e,"url"),this.url=e,typeof t=="object"?this.httpConnectionOptions={...this.httpConnectionOptions,...t}:this.httpConnectionOptions={...this.httpConnectionOptions,transport:t},this}withHubProtocol(e){return ee.isRequired(e,"protocol"),this.protocol=e,this}withAutomaticReconnect(e){if(this.reconnectPolicy)throw new Error("A reconnectPolicy has already been set.");return e?Array.isArray(e)?this.reconnectPolicy=new fn(e):this.reconnectPolicy=e:this.reconnectPolicy=new fn,this}withServerTimeout(e){return ee.isRequired(e,"milliseconds"),this._serverTimeoutInMilliseconds=e,this}withKeepAliveInterval(e){return ee.isRequired(e,"milliseconds"),this._keepAliveIntervalInMilliseconds=e,this}withStatefulReconnect(e){return this.httpConnectionOptions===void 0&&(this.httpConnectionOptions={}),this.httpConnectionOptions._useStatefulReconnect=!0,this._statefulReconnectBufferSize=e==null?void 0:e.bufferSize,this}build(){const e=this.httpConnectionOptions||{};if(e.logger===void 0&&(e.logger=this.logger),!this.url)throw new Error("The 'HubConnectionBuilder.withUrl' method must be called before building the connection.");const t=new ms(this.url,e);return Vt.create(t,this.logger||qe.instance,this.protocol||new ys,this.reconnectPolicy,this._serverTimeoutInMilliseconds,this._keepAliveIntervalInMilliseconds,this._statefulReconnectBufferSize)}}function Es(n){return n.log!==void 0}var Re=4294967295;function ks(n,e,t){var r=t/4294967296,s=t;n.setUint32(e,r),n.setUint32(e+4,s)}function Xn(n,e,t){var r=Math.floor(t/4294967296),s=t;n.setUint32(e,r),n.setUint32(e+4,s)}function Kn(n,e){var t=n.getInt32(e),r=n.getUint32(e+4);return t*4294967296+r}function Is(n,e){var t=n.getUint32(e),r=n.getUint32(e+4);return t*4294967296+r}var Kt={},At,Dt,Rt,xt=(typeof process>"u"||((At=process==null?void 0:Kt)===null||At===void 0?void 0:At.TEXT_ENCODING)!=="never")&&typeof TextEncoder<"u"&&typeof TextDecoder<"u";function gn(n){for(var e=n.length,t=0,r=0;r<e;){var s=n.charCodeAt(r++);if(s&4294967168)if(!(s&4294965248))t+=2;else{if(s>=55296&&s<=56319&&r<e){var o=n.charCodeAt(r);(o&64512)===56320&&(++r,s=((s&1023)<<10)+(o&1023)+65536)}s&4294901760?t+=4:t+=3}else{t++;continue}}return t}function Ps(n,e,t){for(var r=n.length,s=t,o=0;o<r;){var i=n.charCodeAt(o++);if(i&4294967168)if(!(i&4294965248))e[s++]=i>>6&31|192;else{if(i>=55296&&i<=56319&&o<r){var a=n.charCodeAt(o);(a&64512)===56320&&(++o,i=((i&1023)<<10)+(a&1023)+65536)}i&4294901760?(e[s++]=i>>18&7|240,e[s++]=i>>12&63|128,e[s++]=i>>6&63|128):(e[s++]=i>>12&15|224,e[s++]=i>>6&63|128)}else{e[s++]=i;continue}e[s++]=i&63|128}}var nt=xt?new TextEncoder:void 0,Ts=xt?typeof process<"u"&&((Dt=process==null?void 0:Kt)===null||Dt===void 0?void 0:Dt.TEXT_ENCODING)!=="force"?200:0:Re;function xs(n,e,t){e.set(nt.encode(n),t)}function Us(n,e,t){nt.encodeInto(n,e.subarray(t))}var As=nt!=null&&nt.encodeInto?Us:xs,Ds=4096;function jn(n,e,t){for(var r=e,s=r+t,o=[],i="";r<s;){var a=n[r++];if(!(a&128))o.push(a);else if((a&224)===192){var c=n[r++]&63;o.push((a&31)<<6|c)}else if((a&240)===224){var c=n[r++]&63,l=n[r++]&63;o.push((a&31)<<12|c<<6|l)}else if((a&248)===240){var c=n[r++]&63,l=n[r++]&63,h=n[r++]&63,f=(a&7)<<18|c<<12|l<<6|h;f>65535&&(f-=65536,o.push(f>>>10&1023|55296),f=56320|f&1023),o.push(f)}else o.push(a);o.length>=Ds&&(i+=String.fromCharCode.apply(String,o),o.length=0)}return o.length>0&&(i+=String.fromCharCode.apply(String,o)),i}var Rs=xt?new TextDecoder:null,$s=xt?typeof process<"u"&&((Rt=process==null?void 0:Kt)===null||Rt===void 0?void 0:Rt.TEXT_DECODER)!=="force"?200:0:Re;function Ms(n,e,t){var r=n.subarray(e,e+t);return Rs.decode(r)}var gt=function(){function n(e,t){this.type=e,this.data=t}return n}(),Ls=function(){var n=function(e,t){return n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,s){r.__proto__=s}||function(r,s){for(var o in s)Object.prototype.hasOwnProperty.call(s,o)&&(r[o]=s[o])},n(e,t)};return function(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");n(e,t);function r(){this.constructor=e}e.prototype=t===null?Object.create(t):(r.prototype=t.prototype,new r)}}(),Ee=function(n){Ls(e,n);function e(t){var r=n.call(this,t)||this,s=Object.create(e.prototype);return Object.setPrototypeOf(r,s),Object.defineProperty(r,"name",{configurable:!0,enumerable:!1,value:e.name}),r}return e}(Error),Ns=-1,Hs=4294967296-1,Bs=17179869184-1;function Os(n){var e=n.sec,t=n.nsec;if(e>=0&&t>=0&&e<=Bs)if(t===0&&e<=Hs){var r=new Uint8Array(4),s=new DataView(r.buffer);return s.setUint32(0,e),r}else{var o=e/4294967296,i=e&4294967295,r=new Uint8Array(8),s=new DataView(r.buffer);return s.setUint32(0,t<<2|o&3),s.setUint32(4,i),r}else{var r=new Uint8Array(12),s=new DataView(r.buffer);return s.setUint32(0,t),Xn(s,4,e),r}}function Ws(n){var e=n.getTime(),t=Math.floor(e/1e3),r=(e-t*1e3)*1e6,s=Math.floor(r/1e9);return{sec:t+s,nsec:r-s*1e9}}function zs(n){if(n instanceof Date){var e=Ws(n);return Os(e)}else return null}function Fs(n){var e=new DataView(n.buffer,n.byteOffset,n.byteLength);switch(n.byteLength){case 4:{var t=e.getUint32(0),r=0;return{sec:t,nsec:r}}case 8:{var s=e.getUint32(0),o=e.getUint32(4),t=(s&3)*4294967296+o,r=s>>>2;return{sec:t,nsec:r}}case 12:{var t=Kn(e,4),r=e.getUint32(0);return{sec:t,nsec:r}}default:throw new Ee("Unrecognized data size for timestamp (expected 4, 8, or 12): ".concat(n.length))}}function Gs(n){var e=Fs(n);return new Date(e.sec*1e3+e.nsec/1e6)}var qs={type:Ns,encode:zs,decode:Gs},Jn=function(){function n(){this.builtInEncoders=[],this.builtInDecoders=[],this.encoders=[],this.decoders=[],this.register(qs)}return n.prototype.register=function(e){var t=e.type,r=e.encode,s=e.decode;if(t>=0)this.encoders[t]=r,this.decoders[t]=s;else{var o=1+t;this.builtInEncoders[o]=r,this.builtInDecoders[o]=s}},n.prototype.tryToEncode=function(e,t){for(var r=0;r<this.builtInEncoders.length;r++){var s=this.builtInEncoders[r];if(s!=null){var o=s(e,t);if(o!=null){var i=-1-r;return new gt(i,o)}}}for(var r=0;r<this.encoders.length;r++){var s=this.encoders[r];if(s!=null){var o=s(e,t);if(o!=null){var i=r;return new gt(i,o)}}}return e instanceof gt?e:null},n.prototype.decode=function(e,t,r){var s=t<0?this.builtInDecoders[-1-t]:this.decoders[t];return s?s(e,t,r):new gt(t,e)},n.defaultCodec=new n,n}();function Et(n){return n instanceof Uint8Array?n:ArrayBuffer.isView(n)?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):n instanceof ArrayBuffer?new Uint8Array(n):Uint8Array.from(n)}function Vs(n){if(n instanceof ArrayBuffer)return new DataView(n);var e=Et(n);return new DataView(e.buffer,e.byteOffset,e.byteLength)}var Xs=100,Ks=2048,js=function(){function n(e,t,r,s,o,i,a,c){e===void 0&&(e=Jn.defaultCodec),t===void 0&&(t=void 0),r===void 0&&(r=Xs),s===void 0&&(s=Ks),o===void 0&&(o=!1),i===void 0&&(i=!1),a===void 0&&(a=!1),c===void 0&&(c=!1),this.extensionCodec=e,this.context=t,this.maxDepth=r,this.initialBufferSize=s,this.sortKeys=o,this.forceFloat32=i,this.ignoreUndefined=a,this.forceIntegerToFloat=c,this.pos=0,this.view=new DataView(new ArrayBuffer(this.initialBufferSize)),this.bytes=new Uint8Array(this.view.buffer)}return n.prototype.reinitializeState=function(){this.pos=0},n.prototype.encodeSharedRef=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.subarray(0,this.pos)},n.prototype.encode=function(e){return this.reinitializeState(),this.doEncode(e,1),this.bytes.slice(0,this.pos)},n.prototype.doEncode=function(e,t){if(t>this.maxDepth)throw new Error("Too deep objects in depth ".concat(t));e==null?this.encodeNil():typeof e=="boolean"?this.encodeBoolean(e):typeof e=="number"?this.encodeNumber(e):typeof e=="string"?this.encodeString(e):this.encodeObject(e,t)},n.prototype.ensureBufferSizeToWrite=function(e){var t=this.pos+e;this.view.byteLength<t&&this.resizeBuffer(t*2)},n.prototype.resizeBuffer=function(e){var t=new ArrayBuffer(e),r=new Uint8Array(t),s=new DataView(t);r.set(this.bytes),this.view=s,this.bytes=r},n.prototype.encodeNil=function(){this.writeU8(192)},n.prototype.encodeBoolean=function(e){e===!1?this.writeU8(194):this.writeU8(195)},n.prototype.encodeNumber=function(e){Number.isSafeInteger(e)&&!this.forceIntegerToFloat?e>=0?e<128?this.writeU8(e):e<256?(this.writeU8(204),this.writeU8(e)):e<65536?(this.writeU8(205),this.writeU16(e)):e<4294967296?(this.writeU8(206),this.writeU32(e)):(this.writeU8(207),this.writeU64(e)):e>=-32?this.writeU8(224|e+32):e>=-128?(this.writeU8(208),this.writeI8(e)):e>=-32768?(this.writeU8(209),this.writeI16(e)):e>=-2147483648?(this.writeU8(210),this.writeI32(e)):(this.writeU8(211),this.writeI64(e)):this.forceFloat32?(this.writeU8(202),this.writeF32(e)):(this.writeU8(203),this.writeF64(e))},n.prototype.writeStringHeader=function(e){if(e<32)this.writeU8(160+e);else if(e<256)this.writeU8(217),this.writeU8(e);else if(e<65536)this.writeU8(218),this.writeU16(e);else if(e<4294967296)this.writeU8(219),this.writeU32(e);else throw new Error("Too long string: ".concat(e," bytes in UTF-8"))},n.prototype.encodeString=function(e){var t=5,r=e.length;if(r>Ts){var s=gn(e);this.ensureBufferSizeToWrite(t+s),this.writeStringHeader(s),As(e,this.bytes,this.pos),this.pos+=s}else{var s=gn(e);this.ensureBufferSizeToWrite(t+s),this.writeStringHeader(s),Ps(e,this.bytes,this.pos),this.pos+=s}},n.prototype.encodeObject=function(e,t){var r=this.extensionCodec.tryToEncode(e,this.context);if(r!=null)this.encodeExtension(r);else if(Array.isArray(e))this.encodeArray(e,t);else if(ArrayBuffer.isView(e))this.encodeBinary(e);else if(typeof e=="object")this.encodeMap(e,t);else throw new Error("Unrecognized object: ".concat(Object.prototype.toString.apply(e)))},n.prototype.encodeBinary=function(e){var t=e.byteLength;if(t<256)this.writeU8(196),this.writeU8(t);else if(t<65536)this.writeU8(197),this.writeU16(t);else if(t<4294967296)this.writeU8(198),this.writeU32(t);else throw new Error("Too large binary: ".concat(t));var r=Et(e);this.writeU8a(r)},n.prototype.encodeArray=function(e,t){var r=e.length;if(r<16)this.writeU8(144+r);else if(r<65536)this.writeU8(220),this.writeU16(r);else if(r<4294967296)this.writeU8(221),this.writeU32(r);else throw new Error("Too large array: ".concat(r));for(var s=0,o=e;s<o.length;s++){var i=o[s];this.doEncode(i,t+1)}},n.prototype.countWithoutUndefined=function(e,t){for(var r=0,s=0,o=t;s<o.length;s++){var i=o[s];e[i]!==void 0&&r++}return r},n.prototype.encodeMap=function(e,t){var r=Object.keys(e);this.sortKeys&&r.sort();var s=this.ignoreUndefined?this.countWithoutUndefined(e,r):r.length;if(s<16)this.writeU8(128+s);else if(s<65536)this.writeU8(222),this.writeU16(s);else if(s<4294967296)this.writeU8(223),this.writeU32(s);else throw new Error("Too large map object: ".concat(s));for(var o=0,i=r;o<i.length;o++){var a=i[o],c=e[a];this.ignoreUndefined&&c===void 0||(this.encodeString(a),this.doEncode(c,t+1))}},n.prototype.encodeExtension=function(e){var t=e.data.length;if(t===1)this.writeU8(212);else if(t===2)this.writeU8(213);else if(t===4)this.writeU8(214);else if(t===8)this.writeU8(215);else if(t===16)this.writeU8(216);else if(t<256)this.writeU8(199),this.writeU8(t);else if(t<65536)this.writeU8(200),this.writeU16(t);else if(t<4294967296)this.writeU8(201),this.writeU32(t);else throw new Error("Too large extension object: ".concat(t));this.writeI8(e.type),this.writeU8a(e.data)},n.prototype.writeU8=function(e){this.ensureBufferSizeToWrite(1),this.view.setUint8(this.pos,e),this.pos++},n.prototype.writeU8a=function(e){var t=e.length;this.ensureBufferSizeToWrite(t),this.bytes.set(e,this.pos),this.pos+=t},n.prototype.writeI8=function(e){this.ensureBufferSizeToWrite(1),this.view.setInt8(this.pos,e),this.pos++},n.prototype.writeU16=function(e){this.ensureBufferSizeToWrite(2),this.view.setUint16(this.pos,e),this.pos+=2},n.prototype.writeI16=function(e){this.ensureBufferSizeToWrite(2),this.view.setInt16(this.pos,e),this.pos+=2},n.prototype.writeU32=function(e){this.ensureBufferSizeToWrite(4),this.view.setUint32(this.pos,e),this.pos+=4},n.prototype.writeI32=function(e){this.ensureBufferSizeToWrite(4),this.view.setInt32(this.pos,e),this.pos+=4},n.prototype.writeF32=function(e){this.ensureBufferSizeToWrite(4),this.view.setFloat32(this.pos,e),this.pos+=4},n.prototype.writeF64=function(e){this.ensureBufferSizeToWrite(8),this.view.setFloat64(this.pos,e),this.pos+=8},n.prototype.writeU64=function(e){this.ensureBufferSizeToWrite(8),ks(this.view,this.pos,e),this.pos+=8},n.prototype.writeI64=function(e){this.ensureBufferSizeToWrite(8),Xn(this.view,this.pos,e),this.pos+=8},n}();function $t(n){return"".concat(n<0?"-":"","0x").concat(Math.abs(n).toString(16).padStart(2,"0"))}var Js=16,Ys=16,Zs=function(){function n(e,t){e===void 0&&(e=Js),t===void 0&&(t=Ys),this.maxKeyLength=e,this.maxLengthPerKey=t,this.hit=0,this.miss=0,this.caches=[];for(var r=0;r<this.maxKeyLength;r++)this.caches.push([])}return n.prototype.canBeCached=function(e){return e>0&&e<=this.maxKeyLength},n.prototype.find=function(e,t,r){var s=this.caches[r-1];e:for(var o=0,i=s;o<i.length;o++){for(var a=i[o],c=a.bytes,l=0;l<r;l++)if(c[l]!==e[t+l])continue e;return a.str}return null},n.prototype.store=function(e,t){var r=this.caches[e.length-1],s={bytes:e,str:t};r.length>=this.maxLengthPerKey?r[Math.random()*r.length|0]=s:r.push(s)},n.prototype.decode=function(e,t,r){var s=this.find(e,t,r);if(s!=null)return this.hit++,s;this.miss++;var o=jn(e,t,r),i=Uint8Array.prototype.slice.call(e,t,t+r);return this.store(i,o),o},n}(),Qs=function(n,e,t,r){function s(o){return o instanceof t?o:new t(function(i){i(o)})}return new(t||(t=Promise))(function(o,i){function a(h){try{l(r.next(h))}catch(f){i(f)}}function c(h){try{l(r.throw(h))}catch(f){i(f)}}function l(h){h.done?o(h.value):s(h.value).then(a,c)}l((r=r.apply(n,e||[])).next())})},Mt=function(n,e){var t={label:0,sent:function(){if(o[0]&1)throw o[1];return o[1]},trys:[],ops:[]},r,s,o,i;return i={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(i[Symbol.iterator]=function(){return this}),i;function a(l){return function(h){return c([l,h])}}function c(l){if(r)throw new TypeError("Generator is already executing.");for(;t;)try{if(r=1,s&&(o=l[0]&2?s.return:l[0]?s.throw||((o=s.return)&&o.call(s),0):s.next)&&!(o=o.call(s,l[1])).done)return o;switch(s=0,o&&(l=[l[0]&2,o.value]),l[0]){case 0:case 1:o=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,s=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(o=t.trys,!(o=o.length>0&&o[o.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!o||l[1]>o[0]&&l[1]<o[3])){t.label=l[1];break}if(l[0]===6&&t.label<o[1]){t.label=o[1],o=l;break}if(o&&t.label<o[2]){t.label=o[2],t.ops.push(l);break}o[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(n,t)}catch(h){l=[6,h],s=0}finally{r=o=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}},_n=function(n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=n[Symbol.asyncIterator],t;return e?e.call(n):(n=typeof __values=="function"?__values(n):n[Symbol.iterator](),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(o){t[o]=n[o]&&function(i){return new Promise(function(a,c){i=n[o](i),s(a,c,i.done,i.value)})}}function s(o,i,a,c){Promise.resolve(c).then(function(l){o({value:l,done:a})},i)}},Ge=function(n){return this instanceof Ge?(this.v=n,this):new Ge(n)},eo=function(n,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=t.apply(n,e||[]),s,o=[];return s={},i("next"),i("throw"),i("return"),s[Symbol.asyncIterator]=function(){return this},s;function i(p){r[p]&&(s[p]=function(g){return new Promise(function(w,E){o.push([p,g,w,E])>1||a(p,g)})})}function a(p,g){try{c(r[p](g))}catch(w){f(o[0][3],w)}}function c(p){p.value instanceof Ge?Promise.resolve(p.value.v).then(l,h):f(o[0][2],p)}function l(p){a("next",p)}function h(p){a("throw",p)}function f(p,g){p(g),o.shift(),o.length&&a(o[0][0],o[0][1])}},to=function(n){var e=typeof n;return e==="string"||e==="number"},Je=-1,jt=new DataView(new ArrayBuffer(0)),no=new Uint8Array(jt.buffer),Ht=function(){try{jt.getInt8(0)}catch(n){return n.constructor}throw new Error("never reached")}(),mn=new Ht("Insufficient data"),ro=new Zs,so=function(){function n(e,t,r,s,o,i,a,c){e===void 0&&(e=Jn.defaultCodec),t===void 0&&(t=void 0),r===void 0&&(r=Re),s===void 0&&(s=Re),o===void 0&&(o=Re),i===void 0&&(i=Re),a===void 0&&(a=Re),c===void 0&&(c=ro),this.extensionCodec=e,this.context=t,this.maxStrLength=r,this.maxBinLength=s,this.maxArrayLength=o,this.maxMapLength=i,this.maxExtLength=a,this.keyDecoder=c,this.totalPos=0,this.pos=0,this.view=jt,this.bytes=no,this.headByte=Je,this.stack=[]}return n.prototype.reinitializeState=function(){this.totalPos=0,this.headByte=Je,this.stack.length=0},n.prototype.setBuffer=function(e){this.bytes=Et(e),this.view=Vs(this.bytes),this.pos=0},n.prototype.appendBuffer=function(e){if(this.headByte===Je&&!this.hasRemaining(1))this.setBuffer(e);else{var t=this.bytes.subarray(this.pos),r=Et(e),s=new Uint8Array(t.length+r.length);s.set(t),s.set(r,t.length),this.setBuffer(s)}},n.prototype.hasRemaining=function(e){return this.view.byteLength-this.pos>=e},n.prototype.createExtraByteError=function(e){var t=this,r=t.view,s=t.pos;return new RangeError("Extra ".concat(r.byteLength-s," of ").concat(r.byteLength," byte(s) found at buffer[").concat(e,"]"))},n.prototype.decode=function(e){this.reinitializeState(),this.setBuffer(e);var t=this.doDecodeSync();if(this.hasRemaining(1))throw this.createExtraByteError(this.pos);return t},n.prototype.decodeMulti=function(e){return Mt(this,function(t){switch(t.label){case 0:this.reinitializeState(),this.setBuffer(e),t.label=1;case 1:return this.hasRemaining(1)?[4,this.doDecodeSync()]:[3,3];case 2:return t.sent(),[3,1];case 3:return[2]}})},n.prototype.decodeAsync=function(e){var t,r,s,o;return Qs(this,void 0,void 0,function(){var i,a,c,l,h,f,p,g;return Mt(this,function(w){switch(w.label){case 0:i=!1,w.label=1;case 1:w.trys.push([1,6,7,12]),t=_n(e),w.label=2;case 2:return[4,t.next()];case 3:if(r=w.sent(),!!r.done)return[3,5];if(c=r.value,i)throw this.createExtraByteError(this.totalPos);this.appendBuffer(c);try{a=this.doDecodeSync(),i=!0}catch(E){if(!(E instanceof Ht))throw E}this.totalPos+=this.pos,w.label=4;case 4:return[3,2];case 5:return[3,12];case 6:return l=w.sent(),s={error:l},[3,12];case 7:return w.trys.push([7,,10,11]),r&&!r.done&&(o=t.return)?[4,o.call(t)]:[3,9];case 8:w.sent(),w.label=9;case 9:return[3,11];case 10:if(s)throw s.error;return[7];case 11:return[7];case 12:if(i){if(this.hasRemaining(1))throw this.createExtraByteError(this.totalPos);return[2,a]}throw h=this,f=h.headByte,p=h.pos,g=h.totalPos,new RangeError("Insufficient data in parsing ".concat($t(f)," at ").concat(g," (").concat(p," in the current buffer)"))}})})},n.prototype.decodeArrayStream=function(e){return this.decodeMultiAsync(e,!0)},n.prototype.decodeStream=function(e){return this.decodeMultiAsync(e,!1)},n.prototype.decodeMultiAsync=function(e,t){return eo(this,arguments,function(){var s,o,i,a,c,l,h,f,p;return Mt(this,function(g){switch(g.label){case 0:s=t,o=-1,g.label=1;case 1:g.trys.push([1,13,14,19]),i=_n(e),g.label=2;case 2:return[4,Ge(i.next())];case 3:if(a=g.sent(),!!a.done)return[3,12];if(c=a.value,t&&o===0)throw this.createExtraByteError(this.totalPos);this.appendBuffer(c),s&&(o=this.readArraySize(),s=!1,this.complete()),g.label=4;case 4:g.trys.push([4,9,,10]),g.label=5;case 5:return[4,Ge(this.doDecodeSync())];case 6:return[4,g.sent()];case 7:return g.sent(),--o===0?[3,8]:[3,5];case 8:return[3,10];case 9:if(l=g.sent(),!(l instanceof Ht))throw l;return[3,10];case 10:this.totalPos+=this.pos,g.label=11;case 11:return[3,2];case 12:return[3,19];case 13:return h=g.sent(),f={error:h},[3,19];case 14:return g.trys.push([14,,17,18]),a&&!a.done&&(p=i.return)?[4,Ge(p.call(i))]:[3,16];case 15:g.sent(),g.label=16;case 16:return[3,18];case 17:if(f)throw f.error;return[7];case 18:return[7];case 19:return[2]}})})},n.prototype.doDecodeSync=function(){e:for(;;){var e=this.readHeadByte(),t=void 0;if(e>=224)t=e-256;else if(e<192)if(e<128)t=e;else if(e<144){var r=e-128;if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e<160){var r=e-144;if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else{var s=e-160;t=this.decodeUtf8String(s,0)}else if(e===192)t=null;else if(e===194)t=!1;else if(e===195)t=!0;else if(e===202)t=this.readF32();else if(e===203)t=this.readF64();else if(e===204)t=this.readU8();else if(e===205)t=this.readU16();else if(e===206)t=this.readU32();else if(e===207)t=this.readU64();else if(e===208)t=this.readI8();else if(e===209)t=this.readI16();else if(e===210)t=this.readI32();else if(e===211)t=this.readI64();else if(e===217){var s=this.lookU8();t=this.decodeUtf8String(s,1)}else if(e===218){var s=this.lookU16();t=this.decodeUtf8String(s,2)}else if(e===219){var s=this.lookU32();t=this.decodeUtf8String(s,4)}else if(e===220){var r=this.readU16();if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else if(e===221){var r=this.readU32();if(r!==0){this.pushArrayState(r),this.complete();continue e}else t=[]}else if(e===222){var r=this.readU16();if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e===223){var r=this.readU32();if(r!==0){this.pushMapState(r),this.complete();continue e}else t={}}else if(e===196){var r=this.lookU8();t=this.decodeBinary(r,1)}else if(e===197){var r=this.lookU16();t=this.decodeBinary(r,2)}else if(e===198){var r=this.lookU32();t=this.decodeBinary(r,4)}else if(e===212)t=this.decodeExtension(1,0);else if(e===213)t=this.decodeExtension(2,0);else if(e===214)t=this.decodeExtension(4,0);else if(e===215)t=this.decodeExtension(8,0);else if(e===216)t=this.decodeExtension(16,0);else if(e===199){var r=this.lookU8();t=this.decodeExtension(r,1)}else if(e===200){var r=this.lookU16();t=this.decodeExtension(r,2)}else if(e===201){var r=this.lookU32();t=this.decodeExtension(r,4)}else throw new Ee("Unrecognized type byte: ".concat($t(e)));this.complete();for(var o=this.stack;o.length>0;){var i=o[o.length-1];if(i.type===0)if(i.array[i.position]=t,i.position++,i.position===i.size)o.pop(),t=i.array;else continue e;else if(i.type===1){if(!to(t))throw new Ee("The type of key must be string or number but "+typeof t);if(t==="__proto__")throw new Ee("The key __proto__ is not allowed");i.key=t,i.type=2;continue e}else if(i.map[i.key]=t,i.readCount++,i.readCount===i.size)o.pop(),t=i.map;else{i.key=null,i.type=1;continue e}}return t}},n.prototype.readHeadByte=function(){return this.headByte===Je&&(this.headByte=this.readU8()),this.headByte},n.prototype.complete=function(){this.headByte=Je},n.prototype.readArraySize=function(){var e=this.readHeadByte();switch(e){case 220:return this.readU16();case 221:return this.readU32();default:{if(e<160)return e-144;throw new Ee("Unrecognized array type byte: ".concat($t(e)))}}},n.prototype.pushMapState=function(e){if(e>this.maxMapLength)throw new Ee("Max length exceeded: map length (".concat(e,") > maxMapLengthLength (").concat(this.maxMapLength,")"));this.stack.push({type:1,size:e,key:null,readCount:0,map:{}})},n.prototype.pushArrayState=function(e){if(e>this.maxArrayLength)throw new Ee("Max length exceeded: array length (".concat(e,") > maxArrayLength (").concat(this.maxArrayLength,")"));this.stack.push({type:0,size:e,array:new Array(e),position:0})},n.prototype.decodeUtf8String=function(e,t){var r;if(e>this.maxStrLength)throw new Ee("Max length exceeded: UTF-8 byte length (".concat(e,") > maxStrLength (").concat(this.maxStrLength,")"));if(this.bytes.byteLength<this.pos+t+e)throw mn;var s=this.pos+t,o;return this.stateIsMapKey()&&(!((r=this.keyDecoder)===null||r===void 0)&&r.canBeCached(e))?o=this.keyDecoder.decode(this.bytes,s,e):e>$s?o=Ms(this.bytes,s,e):o=jn(this.bytes,s,e),this.pos+=t+e,o},n.prototype.stateIsMapKey=function(){if(this.stack.length>0){var e=this.stack[this.stack.length-1];return e.type===1}return!1},n.prototype.decodeBinary=function(e,t){if(e>this.maxBinLength)throw new Ee("Max length exceeded: bin length (".concat(e,") > maxBinLength (").concat(this.maxBinLength,")"));if(!this.hasRemaining(e+t))throw mn;var r=this.pos+t,s=this.bytes.subarray(r,r+e);return this.pos+=t+e,s},n.prototype.decodeExtension=function(e,t){if(e>this.maxExtLength)throw new Ee("Max length exceeded: ext length (".concat(e,") > maxExtLength (").concat(this.maxExtLength,")"));var r=this.view.getInt8(this.pos+t),s=this.decodeBinary(e,t+1);return this.extensionCodec.decode(s,r,this.context)},n.prototype.lookU8=function(){return this.view.getUint8(this.pos)},n.prototype.lookU16=function(){return this.view.getUint16(this.pos)},n.prototype.lookU32=function(){return this.view.getUint32(this.pos)},n.prototype.readU8=function(){var e=this.view.getUint8(this.pos);return this.pos++,e},n.prototype.readI8=function(){var e=this.view.getInt8(this.pos);return this.pos++,e},n.prototype.readU16=function(){var e=this.view.getUint16(this.pos);return this.pos+=2,e},n.prototype.readI16=function(){var e=this.view.getInt16(this.pos);return this.pos+=2,e},n.prototype.readU32=function(){var e=this.view.getUint32(this.pos);return this.pos+=4,e},n.prototype.readI32=function(){var e=this.view.getInt32(this.pos);return this.pos+=4,e},n.prototype.readU64=function(){var e=Is(this.view,this.pos);return this.pos+=8,e},n.prototype.readI64=function(){var e=Kn(this.view,this.pos);return this.pos+=8,e},n.prototype.readF32=function(){var e=this.view.getFloat32(this.pos);return this.pos+=4,e},n.prototype.readF64=function(){var e=this.view.getFloat64(this.pos);return this.pos+=8,e},n}();class Ce{static write(e){let t=e.byteLength||e.length;const r=[];do{let o=t&127;t=t>>7,t>0&&(o|=128),r.push(o)}while(t>0);t=e.byteLength||e.length;const s=new Uint8Array(r.length+t);return s.set(r,0),s.set(e,r.length),s.buffer}static parse(e){const t=[],r=new Uint8Array(e),s=5,o=[0,7,14,21,28];for(let i=0;i<e.byteLength;){let a=0,c=0,l;do l=r[i+a],c=c|(l&127)<<o[a],a++;while(a<Math.min(s,e.byteLength-i)&&l&128);if(l&128&&a<s)throw new Error("Cannot read message size.");if(a===s&&l>7)throw new Error("Messages bigger than 2GB are not supported.");if(r.byteLength>=i+a+c)t.push(r.slice?r.slice(i+a,i+a+c):r.subarray(i+a,i+a+c));else throw new Error("Incomplete message.");i=i+a+c}return t}}function oo(n){return n&&typeof ArrayBuffer<"u"&&(n instanceof ArrayBuffer||n.constructor&&n.constructor.name==="ArrayBuffer")}const io=new Uint8Array([145,k.Ping]);class ao{constructor(e){this.name="messagepack",this.version=2,this.transferFormat=oe.Binary,this._errorResult=1,this._voidResult=2,this._nonVoidResult=3,e=e||{},this._encoder=new js(e.extensionCodec,e.context,e.maxDepth,e.initialBufferSize,e.sortKeys,e.forceFloat32,e.ignoreUndefined,e.forceIntegerToFloat),this._decoder=new so(e.extensionCodec,e.context,e.maxStrLength,e.maxBinLength,e.maxArrayLength,e.maxMapLength,e.maxExtLength)}parseMessages(e,t){if(!oo(e))throw new Error("Invalid input for MessagePack hub protocol. Expected an ArrayBuffer.");t===null&&(t=qe.instance);const r=Ce.parse(e),s=[];for(const o of r){const i=this._parseMessage(o,t);i&&s.push(i)}return s}writeMessage(e){switch(e.type){case k.Invocation:return this._writeInvocation(e);case k.StreamInvocation:return this._writeStreamInvocation(e);case k.StreamItem:return this._writeStreamItem(e);case k.Completion:return this._writeCompletion(e);case k.Ping:return Ce.write(io);case k.CancelInvocation:return this._writeCancelInvocation(e);case k.Close:return this._writeClose();case k.Ack:return this._writeAck(e);case k.Sequence:return this._writeSequence(e);default:throw new Error("Invalid message type.")}}_parseMessage(e,t){if(e.length===0)throw new Error("Invalid payload.");const r=this._decoder.decode(e);if(r.length===0||!(r instanceof Array))throw new Error("Invalid payload.");const s=r[0];switch(s){case k.Invocation:return this._createInvocationMessage(this._readHeaders(r),r);case k.StreamItem:return this._createStreamItemMessage(this._readHeaders(r),r);case k.Completion:return this._createCompletionMessage(this._readHeaders(r),r);case k.Ping:return this._createPingMessage(r);case k.Close:return this._createCloseMessage(r);case k.Ack:return this._createAckMessage(r);case k.Sequence:return this._createSequenceMessage(r);default:return t.log(m.Information,"Unknown message type '"+s+"' ignored."),null}}_createCloseMessage(e){if(e.length<2)throw new Error("Invalid payload for Close message.");return{allowReconnect:e.length>=3?e[2]:void 0,error:e[1],type:k.Close}}_createPingMessage(e){if(e.length<1)throw new Error("Invalid payload for Ping message.");return{type:k.Ping}}_createInvocationMessage(e,t){if(t.length<5)throw new Error("Invalid payload for Invocation message.");const r=t[2];return r?{arguments:t[4],headers:e,invocationId:r,streamIds:[],target:t[3],type:k.Invocation}:{arguments:t[4],headers:e,streamIds:[],target:t[3],type:k.Invocation}}_createStreamItemMessage(e,t){if(t.length<4)throw new Error("Invalid payload for StreamItem message.");return{headers:e,invocationId:t[2],item:t[3],type:k.StreamItem}}_createCompletionMessage(e,t){if(t.length<4)throw new Error("Invalid payload for Completion message.");const r=t[3];if(r!==this._voidResult&&t.length<5)throw new Error("Invalid payload for Completion message.");let s,o;switch(r){case this._errorResult:s=t[4];break;case this._nonVoidResult:o=t[4];break}return{error:s,headers:e,invocationId:t[2],result:o,type:k.Completion}}_createAckMessage(e){if(e.length<1)throw new Error("Invalid payload for Ack message.");return{sequenceId:e[1],type:k.Ack}}_createSequenceMessage(e){if(e.length<1)throw new Error("Invalid payload for Sequence message.");return{sequenceId:e[1],type:k.Sequence}}_writeInvocation(e){let t;return e.streamIds?t=this._encoder.encode([k.Invocation,e.headers||{},e.invocationId||null,e.target,e.arguments,e.streamIds]):t=this._encoder.encode([k.Invocation,e.headers||{},e.invocationId||null,e.target,e.arguments]),Ce.write(t.slice())}_writeStreamInvocation(e){let t;return e.streamIds?t=this._encoder.encode([k.StreamInvocation,e.headers||{},e.invocationId,e.target,e.arguments,e.streamIds]):t=this._encoder.encode([k.StreamInvocation,e.headers||{},e.invocationId,e.target,e.arguments]),Ce.write(t.slice())}_writeStreamItem(e){const t=this._encoder.encode([k.StreamItem,e.headers||{},e.invocationId,e.item]);return Ce.write(t.slice())}_writeCompletion(e){const t=e.error?this._errorResult:e.result!==void 0?this._nonVoidResult:this._voidResult;let r;switch(t){case this._errorResult:r=this._encoder.encode([k.Completion,e.headers||{},e.invocationId,t,e.error]);break;case this._voidResult:r=this._encoder.encode([k.Completion,e.headers||{},e.invocationId,t]);break;case this._nonVoidResult:r=this._encoder.encode([k.Completion,e.headers||{},e.invocationId,t,e.result]);break}return Ce.write(r.slice())}_writeCancelInvocation(e){const t=this._encoder.encode([k.CancelInvocation,e.headers||{},e.invocationId]);return Ce.write(t.slice())}_writeClose(){const e=this._encoder.encode([k.Close,null]);return Ce.write(e.slice())}_writeAck(e){const t=this._encoder.encode([k.Ack,e.sequenceId]);return Ce.write(t.slice())}_writeSequence(e){const t=this._encoder.encode([k.Sequence,e.sequenceId]);return Ce.write(t.slice())}_readHeaders(e){const t=e[1];if(typeof t!="object")throw new Error("Invalid headers.");return t}}const we=new Cs().withUrl("/carthub").configureLogging(m.Warning).withHubProtocol(new ao).withAutomaticReconnect().withStatefulReconnect().build();we.on("GetMessage",n=>{console.log(n),Ar(n)});we.on("ProductAdded",n=>{Pr({amount:n.Amount,isCollected:n.IsCollected,name:n.Name,order:n.Order,unitPrice:n.UnitPrice})});we.on("ProductModified",n=>{Tr({amount:n.Amount,isCollected:n.IsCollected,name:n.Name,order:n.Order,unitPrice:n.UnitPrice})});we.on("ProductDeleted",n=>{xr(n)});we.on("ProductsDeleted",()=>{Ur()});we.on("ProductsSorted",n=>{Fn(n),et.set(n)});async function De(n){try{we.state==="Disconnected"&&(await we.start(),await we.invoke("JoinGroup",n),Gt.set(!0))}catch(e){console.log(e)}}async function co(n){try{await we.invoke("LeaveGroup",n),await we.stop(),Gt.set(!1)}catch(e){console.log(e)}}function Ye(){return we.connectionId??""}class lo{constructor(){H(this,"url","api/cartgroupproducts/");H(this,"getCartProducts",async()=>(await De(this.getGroupId()),await Ke(this.url+this.getGroupId(),"GET",async t=>await t.json())));H(this,"createCartProduct",async e=>(await De(this.getGroupId()),await le(this.url+this.getGroupId(),"POST",e,{ConnectionId:Ye()})));H(this,"updateCartProduct",async e=>(await De(this.getGroupId()),await le(this.url+this.getGroupId(),"PUT",e,{ConnectionId:Ye()})));H(this,"sortCartProducts",async e=>(await De(this.getGroupId()),await le(this.url+this.getGroupId()+"/sort/"+(e==="Ascending"?"0":"1"),"PATCH",void 0,{ConnectionId:Ye()})));H(this,"deleteAllCartProducts",async()=>(await De(this.getGroupId()),await le(this.url+this.getGroupId(),"DELETE",void 0,{ConnectionId:Ye()})));H(this,"deleteCartProduct",async e=>(await De(this.getGroupId()),await le(this.url+this.getGroupId()+"/"+e,"DELETE",void 0,{ConnectionId:Ye()})));H(this,"getGroupId",()=>{const e=window.location.href.lastIndexOf("/");return window.location.href.substring(e+1)})}}async function Yn(){return(await lt()).isAuthenticated?window.location.href.includes("groupcart")?new lo:new $r:new Nr}class uo{constructor(){H(this,"url","api/storeproducts/");H(this,"getStoreProducts",async()=>await Ke(this.url,"GET",async t=>await t.json()));H(this,"createStoreProduct",async e=>await le(this.url,"POST",e));H(this,"updateStoreProduct",async e=>await le(this.url,"PUT",e));H(this,"deleteStoreProducts",async()=>await le(this.url,"DELETE"))}}class ho{constructor(){H(this,"getStoreProducts",async()=>{try{const e=localStorage.getItem(cn);return e?JSON.parse(e):[]}catch(e){return e instanceof Error?e:new Error("Unknow problem loading from local storage")}});H(this,"deleteStoreProducts",()=>this.saveStoreProductsToLocalStorage());H(this,"createStoreProduct",e=>this.saveStoreProductsToLocalStorage());H(this,"updateStoreProduct",e=>this.saveStoreProductsToLocalStorage())}async saveStoreProductsToLocalStorage(){try{return localStorage.setItem(cn,JSON.stringify(Ln(Qe))),null}catch(e){return e instanceof Error?e:new Error("Unknow problem saving to local storage")}}}async function Zn(){return(await lt()).isAuthenticated?new uo:new ho}const{Map:fo}=or;function wn(n,e,t){const r=n.slice();return r[36]=e[t],r}function bn(n,e,t){const r=n.slice();return r[39]=e[t],r}function yn(n){let e,t,r;return{c(){e=_("img"),u(e,"class","scale-50 h-6 dark:invert"),u(e,"alt",t=n[6]=="Ascending"?"sort down":"sort up"),Ie(e.src,r=n[6]=="Ascending"?"icons/arrow-down.svg":"icons/arrow-up.svg")||u(e,"src",r)},m(s,o){A(s,e,o)},p(s,o){o[0]&64&&t!==(t=s[6]=="Ascending"?"sort down":"sort up")&&u(e,"alt",t),o[0]&64&&!Ie(e.src,r=s[6]=="Ascending"?"icons/arrow-down.svg":"icons/arrow-up.svg")&&u(e,"src",r)},d(s){s&&U(e)}}}function vn(n){let e,t;return{c(){e=_("option"),e.__value=t=n[39].name,fe(e,e.__value)},m(r,s){A(r,e,s)},p(r,s){s[0]&48&&t!==(t=r[39].name)&&(e.__value=t,fe(e,e.__value))},d(r){r&&U(e)}}}function po(n){let e,t,r,s,o,i=n[36].product.name+"",a,c,l,h,f,p,g,w,E,C,x=n[36].product.unitPrice*n[36].product.amount+"",I,D,S,b,y;function R(...T){return n[27](n[36],...T)}function $(...T){return n[28](n[36],...T)}function O(){return n[29](n[36])}return{c(){e=_("span"),t=P(),r=_("span"),s=P(),o=_("span"),a=j(i),l=P(),h=_("input"),p=P(),g=_("input"),E=P(),C=_("span"),I=j(x),D=P(),S=_("button"),S.innerHTML='<img class="m-auto invert" src="icons/check.svg" alt="Accept" aria-hidden="true"/>',u(o,"class",c="m-auto "+(n[36].product.isCollected?"line-through":"")),u(o,"aria-label","Product name"),u(h,"type","number"),u(h,"step","0.01"),u(h,"min","0"),u(h,"class","form-control text-center m-auto hidden md:block"),u(h,"aria-label","Edit amount"),h.value=f=n[36].product.amount,u(g,"type","number"),u(g,"step","0.01"),u(g,"min","0"),u(g,"class","form-control text-center my-auto mx-2 hidden sm:block"),u(g,"aria-label","Edit unit price"),g.value=w=n[36].product.unitPrice,u(C,"class","m-auto hidden lg:block"),u(C,"aria-label","Total price"),u(S,"class","btn btn-success m-auto h-9 w-9 p-1"),u(S,"aria-label","Submit edit")},m(T,B){A(T,e,B),A(T,t,B),A(T,r,B),A(T,s,B),A(T,o,B),d(o,a),A(T,l,B),A(T,h,B),A(T,p,B),A(T,g,B),A(T,E,B),A(T,C,B),d(C,I),A(T,D,B),A(T,S,B),b||(y=[q(h,"change",R),q(g,"change",$),q(S,"click",O)],b=!0)},p(T,B){n=T,B[0]&256&&i!==(i=n[36].product.name+"")&&te(a,i),B[0]&256&&c!==(c="m-auto "+(n[36].product.isCollected?"line-through":""))&&u(o,"class",c),B[0]&256&&f!==(f=n[36].product.amount)&&h.value!==f&&(h.value=f),B[0]&256&&w!==(w=n[36].product.unitPrice)&&g.value!==w&&(g.value=w),B[0]&256&&x!==(x=n[36].product.unitPrice*n[36].product.amount+"")&&te(I,x)},d(T){T&&(U(e),U(t),U(r),U(s),U(o),U(l),U(h),U(p),U(g),U(E),U(C),U(D),U(S)),b=!1,ae(y)}}}function go(n){let e,t,r,s,o,i,a,c,l,h=n[36].product.name+"",f,p,g,w,E=n[36].product.amount+"",C,x,I,D=n[36].product.unitPrice+"",S,b,y,R=n[36].product.unitPrice*n[36].product.amount+"",$,O,T,B,W,L,z,Be,_e,me,pe,ie,Ue,Ae;function je(){return n[23](n[36])}function v(...V){return n[24](n[36],...V)}function M(){return n[25](n[36])}function G(){return n[26](n[36])}return{c(){e=_("button"),t=_("img"),o=P(),i=_("input"),c=P(),l=_("span"),f=j(h),g=P(),w=_("span"),C=j(E),x=P(),I=_("span"),S=j(D),b=P(),y=_("span"),$=j(R),O=P(),T=_("div"),B=_("button"),W=_("img"),Be=P(),_e=_("button"),me=_("img"),u(t,"class","m-auto invert w-7 h-7"),Ie(t.src,r="icons/swap.svg")||u(t,"src",r),u(t,"alt","Swap"),u(t,"aria-hidden","true"),u(e,"class",s="btn btn-primary w-9 h-9 p-0 m-auto "+(n[36].product==n[2]?"bg-blue-800":"")),u(e,"aria-label","Reorder"),u(i,"type","checkbox"),u(i,"class","scale-150 m-auto"),i.checked=a=n[36].product.isCollected,u(i,"aria-label","Mark collected"),u(l,"class",p="m-auto "+(n[36].product.isCollected?"line-through":"")),u(l,"aria-label","Product name"),u(w,"class","m-auto hidden md:block"),u(w,"aria-label","Amount"),u(I,"class","m-auto hidden sm:block"),u(I,"aria-label","Unit price"),u(y,"class","m-auto hidden lg:block"),u(y,"aria-label","Total price"),u(W,"class","m-auto invert w-6 h-6"),Ie(W.src,L="icons/edit.svg")||u(W,"src",L),u(W,"alt","Edit"),u(W,"aria-hidden","true"),u(B,"class","btn btn-success w-9 h-9 p-0 m-auto hidden sm:block"),u(B,"aria-label","Edit product"),B.disabled=z=n[36].product.isCollected,u(me,"class","m-auto invert w-6 h-6"),Ie(me.src,pe="icons/delete.svg")||u(me,"src",pe),u(me,"alt","Delete"),u(me,"aria-hidden","true"),u(_e,"class","btn btn-danger w-9 h-9 p-0 m-auto"),u(_e,"aria-label","Delete product"),_e.disabled=ie=n[36].product.isCollected,u(T,"class","flex")},m(V,X){A(V,e,X),d(e,t),A(V,o,X),A(V,i,X),A(V,c,X),A(V,l,X),d(l,f),A(V,g,X),A(V,w,X),d(w,C),A(V,x,X),A(V,I,X),d(I,S),A(V,b,X),A(V,y,X),d(y,$),A(V,O,X),A(V,T,X),d(T,B),d(B,W),d(T,Be),d(T,_e),d(_e,me),Ue||(Ae=[q(e,"click",je),q(i,"change",v),q(B,"click",M),q(_e,"click",G)],Ue=!0)},p(V,X){n=V,X[0]&260&&s!==(s="btn btn-primary w-9 h-9 p-0 m-auto "+(n[36].product==n[2]?"bg-blue-800":""))&&u(e,"class",s),X[0]&256&&a!==(a=n[36].product.isCollected)&&(i.checked=a),X[0]&256&&h!==(h=n[36].product.name+"")&&te(f,h),X[0]&256&&p!==(p="m-auto "+(n[36].product.isCollected?"line-through":""))&&u(l,"class",p),X[0]&256&&E!==(E=n[36].product.amount+"")&&te(C,E),X[0]&256&&D!==(D=n[36].product.unitPrice+"")&&te(S,D),X[0]&256&&R!==(R=n[36].product.unitPrice*n[36].product.amount+"")&&te($,R),X[0]&256&&z!==(z=n[36].product.isCollected)&&(B.disabled=z),X[0]&256&&ie!==(ie=n[36].product.isCollected)&&(_e.disabled=ie)},d(V){V&&(U(e),U(o),U(i),U(c),U(l),U(g),U(w),U(x),U(I),U(b),U(y),U(O),U(T)),Ue=!1,ae(Ae)}}}function Sn(n,e){let t,r,s;function o(c,l){return c[36].product!==c[1]?go:po}let i=o(e),a=i(e);return{key:n,first:null,c(){t=_("div"),a.c(),r=P(),u(t,"role","row"),u(t,"class",s="absolute h-12 w-full grid grid-cols-base sm:grid-cols-sm md:grid-cols-md lg:grid-cols-lg transition-[top] motion-reduce:transition-none border-t-2 "+Cn(e[36].product)),bt(t,"top",e[36].top+"rem"),this.first=t},m(c,l){A(c,t,l),a.m(t,null),d(t,r)},p(c,l){e=c,i===(i=o(e))&&a?a.p(e,l):(a.d(1),a=i(e),a&&(a.c(),a.m(t,r))),l[0]&256&&s!==(s="absolute h-12 w-full grid grid-cols-base sm:grid-cols-sm md:grid-cols-md lg:grid-cols-lg transition-[top] motion-reduce:transition-none border-t-2 "+Cn(e[36].product))&&u(t,"class",s),l[0]&256&&bt(t,"top",e[36].top+"rem")},d(c){c&&U(t),a.d()}}}function _o(n){let e,t,r,s,o,i,a,c,l,h,f,p,g,w,E,C,x,I,D,S,b,y,R,$,O,T,B,W,L,z,Be,_e,me,pe,ie=[],Ue=new fo,Ae,je,v=n[6]!=="None"&&yn(n),M=Te(n[4].filter(n[20])),G=[];for(let N=0;N<M.length;N+=1)G[N]=vn(bn(n,M,N));let V=Te(n[8]);const X=N=>N[36].product.name;for(let N=0;N<V.length;N+=1){let F=wn(n,V,N),K=X(F);Ue.set(K,ie[N]=Sn(K,F))}return{c(){e=_("div"),t=_("span"),t.textContent="Reorder",r=P(),s=_("span"),s.textContent="Collected",o=P(),i=_("div"),a=_("button"),a.textContent="Product",c=P(),v&&v.c(),l=P(),h=_("span"),h.textContent="Amount",f=P(),p=_("span"),p.textContent="Price",g=P(),w=_("span"),w.textContent="Total",E=P(),C=_("span"),x=P(),I=_("span"),D=P(),S=_("div"),b=_("button"),b.textContent="Add",y=P(),R=_("span"),$=_("input"),O=P(),T=_("datalist");for(let N=0;N<G.length;N+=1)G[N].c();B=P(),W=_("input"),L=P(),z=_("input"),Be=P(),_e=_("span"),me=P(),pe=_("div");for(let N=0;N<ie.length;N+=1)ie[N].c();u(t,"class","text-center"),u(s,"class","text-center"),u(a,"aria-label","Sort items"),u(a,"class","cursor-pointer"),u(i,"class","flex justify-center"),u(h,"class","text-center hidden md:block"),u(p,"class","text-center hidden sm:block"),u(w,"class","text-center hidden lg:block"),u(b,"id","add-cartproduct-button"),u(b,"type","submit"),u(b,"class","btn btn-success"),u(b,"aria-label","Add product"),u(S,"class","flex justify-center"),u($,"id","newproduct-name-input"),u($,"type","text"),u($,"list","products"),u($,"class","form-control text-center"),u($,"aria-label","Product name input"),u($,"autocomplete","off"),u(T,"id","products"),u(W,"id","newproduct-amount-input"),u(W,"type","number"),u(W,"step","1"),u(W,"min","1"),u(W,"class","form-control text-center hidden md:block"),u(W,"aria-label","Product amount input"),u(z,"id","newproduct-price-input"),u(z,"type","number"),u(z,"step","0.01"),u(z,"min","0"),u(z,"class","form-control text-center hidden sm:block"),u(z,"aria-label","Product unit price input"),u(e,"role","rowheader"),u(e,"class","grid grid-cols-base sm:grid-cols-sm md:grid-cols-md lg:grid-cols-lg gap-2 justify-center align-middle w-full pt-2 font-semibold"),u(pe,"role","rowgroup"),u(pe,"class","relative transition-[height]"),bt(pe,"height",n[5].filter(n[30]).length*3+1+"rem")},m(N,F){A(N,e,F),d(e,t),d(e,r),d(e,s),d(e,o),d(e,i),d(i,a),d(i,c),v&&v.m(i,null),d(e,l),d(e,h),d(e,f),d(e,p),d(e,g),d(e,w),d(e,E),d(e,C),d(e,x),d(e,I),d(e,D),d(e,S),d(S,b),d(e,y),d(e,R),d(R,$),fe($,n[0].name),n[19]($),d(R,O),d(R,T);for(let K=0;K<G.length;K+=1)G[K]&&G[K].m(T,null);d(e,B),d(e,W),fe(W,n[0].amount),d(e,L),d(e,z),fe(z,n[0].unitPrice),d(e,Be),d(e,_e),A(N,me,F),A(N,pe,F);for(let K=0;K<ie.length;K+=1)ie[K]&&ie[K].m(pe,null);Ae||(je=[q(a,"click",n[11]),q(b,"click",n[12]),q($,"input",n[18]),q($,"focusout",n[10]),q(W,"input",n[21]),q(z,"input",n[22])],Ae=!0)},p(N,F){if(N[6]!=="None"?v?v.p(N,F):(v=yn(N),v.c(),v.m(i,null)):v&&(v.d(1),v=null),F[0]&1&&$.value!==N[0].name&&fe($,N[0].name),F[0]&48){M=Te(N[4].filter(N[20]));let K;for(K=0;K<M.length;K+=1){const Jt=bn(N,M,K);G[K]?G[K].p(Jt,F):(G[K]=vn(Jt),G[K].c(),G[K].m(T,null))}for(;K<G.length;K+=1)G[K].d(1);G.length=M.length}F[0]&1&&wt(W.value)!==N[0].amount&&fe(W,N[0].amount),F[0]&1&&wt(z.value)!==N[0].unitPrice&&fe(z,N[0].unitPrice),F[0]&254214&&(V=Te(N[8]),ie=dr(ie,F,X,1,N,V,Ue,pe,fr,Sn,null,wn)),F[0]&160&&bt(pe,"height",N[5].filter(N[30]).length*3+1+"rem")},i:J,o:J,d(N){N&&(U(e),U(me),U(pe)),v&&v.d(),n[19](null),Wt(G,N);for(let F=0;F<ie.length;F+=1)ie[F].d();Ae=!1,ae(je)}}}function Cn(n){return n.isCollected?"bg-gray-400 dark:bg-gray-600":""}async function mo(n,e){const t=n.target;e.amount=parseFloat(t.value)}async function wo(n,e){const t=n.target;e.unitPrice=parseFloat(t.value)}function bo(n,e,t){let r,s,o,i,a;Pe(n,Qe,v=>t(4,r=v)),Pe(n,se,v=>t(5,s=v)),Pe(n,et,v=>t(6,o=v)),Pe(n,tt,v=>t(7,i=v));let c=new on,l,h,f,p,g;Xe(async()=>{p=await Yn(),g=await Zn();const v=await p.getCartProducts();v instanceof Error?ce(v.message):se.set(v);const M=await g.getStoreProducts();M instanceof Error?ce(M.message):Qe.set(M)});const w=Pt([se,tt],([v,M])=>{const G=[],V=v.filter(F=>!M||!F.isCollected),X=V.toSorted((F,K)=>F.order-K.order),N=new Map;for(let F=0;F<X.length;F++)N.set(X[F].name,.5+3*F);for(const F of V)G.push({product:F,top:N.get(F.name)??0});return G});Pe(n,w,v=>t(8,a=v));function E(){const v=r.find(M=>M.name==c.name);v&&v.unitPrice>0&&t(0,c.unitPrice=v.unitPrice,c)}async function C(){et.update(M=>M==="Ascending"?"Descending":"Ascending");const v=o==="Ascending"?"Ascending":"Descending";Fn(v),ke(await(p==null?void 0:p.sortCartProducts(v)))}async function x(){if(c.name.length===0){ce("Product name not given");return}else if(s.some(M=>M.name===c.name)){ce(`Product ${c.name} is already in cart`);return}else if(c.amount<0||c.amount>1e3){ce("Amount must be between 0 and 10 000");return}else if(c.unitPrice<0||c.unitPrice>1e3){ce("Price must be between 0 and 10 000");return}const v={...c};t(0,c=new on),await I(v),await D(v),f.focus()}async function I(v){v.order=S(),se.update(M=>[...M,v]),ke(await(p==null?void 0:p.createCartProduct(v)))}async function D(v){const M=r.find(G=>G.name==v.name);M?M.unitPrice!==v.unitPrice&&(M.unitPrice=v.unitPrice,ke(await(g==null?void 0:g.updateStoreProduct(M)))):(Qe.update(G=>[...G,{name:v.name,unitPrice:v.unitPrice}]),ke(await(g==null?void 0:g.createStoreProduct(v))))}function S(){return s.length===0?1e3:Math.round(Math.max(...s.map(M=>M.order))+1e3)}async function b(v){v.isCollected=!v.isCollected,se.update(M=>M),ke(await(p==null?void 0:p.updateCartProduct(v)))}function y(v){t(1,l=v)}async function R(v){se.update(M=>M.filter(G=>G.name!==v.name)),ke(await(p==null?void 0:p.deleteCartProduct(v.name)))}async function $(v){t(1,l=null),se.set(s),await(p==null?void 0:p.updateCartProduct(v));const M=r.find(G=>G.name==v.name);M&&M.unitPrice!==v.unitPrice&&(M.unitPrice=v.unitPrice,ke(await(g==null?void 0:g.updateStoreProduct(M))))}async function O(v){h?(v===h||(et.set("None"),se.update(M=>{for(const G of M)G.name===(h==null?void 0:h.name)&&(G.order=Er(M.map(V=>V.order),h.order,v.order));return[...M]}),ke(await(p==null?void 0:p.updateCartProduct(h)))),t(2,h=null)):t(2,h=v)}function T(){c.name=this.value,t(0,c)}function B(v){Ne[v?"unshift":"push"](()=>{f=v,t(3,f)})}const W=v=>s.every(M=>M.name!==v.name);function L(){c.amount=wt(this.value),t(0,c)}function z(){c.unitPrice=wt(this.value),t(0,c)}return[c,l,h,f,r,s,o,i,a,w,E,C,x,b,y,R,$,O,T,B,W,L,z,v=>O(v.product),(v,M)=>b(v.product),v=>y(v.product),v=>R(v.product),(v,M)=>mo(M,v.product),(v,M)=>wo(M,v.product),v=>$(v.product),v=>!i||!v.isCollected]}class Qn extends Se{constructor(e){super(),ve(this,e,bo,_o,be,{},null,[-1,-1])}}function yo(n){let e,t,r,s,o,i,a,c,l,h,f,p,g,w,E,C;return{c(){e=_("dialog"),t=_("div"),r=_("div"),s=_("h3"),o=j(n[0]),i=P(),a=_("div"),c=_("p"),l=j(n[1]),h=P(),f=_("form"),p=_("button"),p.textContent="Yes",g=P(),w=_("button"),w.textContent="No",u(s,"class","text-xl font-semibold"),u(r,"class","bg-[#28a745] text-white p-2"),u(c,"class","pb-2"),u(p,"class","btn btn-success"),u(p,"aria-label","Yes"),u(w,"class","btn btn-danger"),u(w,"aria-label","No"),u(f,"method","dialog"),u(f,"class","flex justify-around"),u(a,"class","p-2 dark:bg-slate-900 dark:text-white"),u(t,"class","font-semibold"),u(e,"class","border-2 border-gray-500 mt-32 rounded max-w-md animate-fade-in-down p-0 backdrop:bg-gray-900/60")},m(x,I){A(x,e,I),d(e,t),d(t,r),d(r,s),d(s,o),d(t,i),d(t,a),d(a,c),d(c,l),d(a,h),d(a,f),d(f,p),d(f,g),d(f,w),n[6](e),E||(C=[q(p,"click",n[3]),q(w,"click",n[4])],E=!0)},p(x,[I]){I&1&&te(o,x[0]),I&2&&te(l,x[1])},i:J,o:J,d(x){x&&U(e),n[6](null),E=!1,ae(C)}}}function vo(n,e,t){let r,{header:s}=e,{message:o}=e;const i=Hn();function a(){i("ok")}function c(){i("cancel")}function l(){r==null||r.showModal()}function h(f){Ne[f?"unshift":"push"](()=>{r=f,t(2,r)})}return n.$$set=f=>{"header"in f&&t(0,s=f.header),"message"in f&&t(1,o=f.message)},[s,o,r,a,c,l,h]}class er extends Se{constructor(e){super(),ve(this,e,vo,yo,be,{header:0,message:1,showModal:5})}get showModal(){return this.$$.ctx[5]}}function So(n){let e,t,r,s,o,i,a,c,l,h,f,p,g,w,E,C,x,I,D,S={header:"Confirm delete",message:n[0]};return C=new er({props:S}),n[12](C),C.$on("ok",function(){it(n[1])&&n[1].apply(this,arguments)}),{c(){e=_("div"),t=_("div"),r=_("input"),s=P(),o=_("label"),o.textContent="Filter collected",i=P(),a=_("b"),c=j("Total: "),l=j(n[3]),h=j(" "),f=P(),p=_("button"),p.textContent="Clear cart",g=P(),w=_("button"),w.textContent="Clear shop",E=P(),de(C.$$.fragment),u(r,"id","filter-collected-checkbox"),u(r,"type","checkbox"),u(r,"class","scale-150"),u(o,"id","filter-collected-label"),u(o,"class","ml-3 mb-[2.75px] font-bold whitespace-nowrap"),u(o,"for","filter-collected-checkbox"),u(t,"class","flex mt-1 ml-4"),u(a,"id","cart-total"),u(p,"class","btn btn-primary w-24"),u(w,"class","btn btn-primary w-24"),u(e,"class","grid grid-cols-2 grid-rows-2 md:grid-cols-4 md:grid-rows-1 place-items-center gap-2 pb-4")},m(b,y){A(b,e,y),d(e,t),d(t,r),d(t,s),d(t,o),d(e,i),d(e,a),d(a,c),d(a,l),d(a,h),d(e,f),d(e,p),d(e,g),d(e,w),A(b,E,y),ue(C,b,y),x=!0,I||(D=[q(r,"change",n[9]),q(p,"click",n[10]),q(w,"click",n[11])],I=!0)},p(b,[y]){n=b,(!x||y&8)&&te(l,n[3]);const R={};y&1&&(R.message=n[0]),C.$set(R)},i(b){x||(Q(C.$$.fragment,b),x=!0)},o(b){ne(C.$$.fragment,b),x=!1},d(b){b&&(U(e),U(E)),n[12](null),he(C,b),I=!1,ae(D)}}}function Co(n,e,t){let r,s;Pe(n,tt,D=>t(15,r=D));let o,i,a,c,l;Xe(async()=>{c=await Yn(),l=await Zn()});let h=Pt(se,D=>D.reduce((S,b)=>S+b.unitPrice*b.amount,0));Pe(n,h,D=>t(3,s=D));function f(D,S){t(0,o=D),t(1,i=S),a.showModal()}function p(D){const S=D.target;tt.set(S.checked),tt.set(r)}async function g(){se.set([]),ke(await(c==null?void 0:c.deleteAllCartProducts()))}async function w(){Qe.set([]),ke(await(l==null?void 0:l.deleteStoreProducts()))}const E=D=>p(D),C=()=>f("Delete all current cart items?",g),x=()=>f("Delete all stored shop items?",w);function I(D){Ne[D?"unshift":"push"](()=>{a=D,t(2,a)})}return[o,i,a,s,h,f,p,g,w,E,C,x,I]}class tr extends Se{constructor(e){super(),ve(this,e,Co,So,be,{})}}function Eo(n){let e,t,r,s;return e=new Qn({}),r=new tr({}),{c(){de(e.$$.fragment),t=P(),de(r.$$.fragment)},m(o,i){ue(e,o,i),A(o,t,i),ue(r,o,i),s=!0},p:J,i(o){s||(Q(e.$$.fragment,o),Q(r.$$.fragment,o),s=!0)},o(o){ne(e.$$.fragment,o),ne(r.$$.fragment,o),s=!1},d(o){o&&U(t),he(e,o),he(r,o)}}}class ko extends Se{constructor(e){super(),ve(this,e,null,Eo,be,{})}}const ut="api/cartgroups/";async function Io(){return await Ke(ut,"GET",async e=>await e.json())}async function Po(n){return await Ke(ut+n,"GET",async t=>await t.json())}async function To(n){return await Ke(ut,"POST",async t=>(await t.text()).trim().replaceAll('"',""),{name:n.name,otherUsers:Array.from(n.otherUsers)})}async function xo(n,e){return await le(ut+n,"PUT",{name:e})}async function Uo(n){return await le(ut+n,"DELETE")}function Ao(n){let e,t,r,s=n[0].name+"",o,i,a,c,l,h,f,p,g,w,E=n[1]?"Sharing cart":"Sharing starting...",C,x,I,D,S=Array.from(n[0].otherUsers).join(", ")+"",b;return{c(){e=_("div"),t=_("div"),r=_("h3"),o=j(s),i=P(),a=_("div"),c=_("p"),h=P(),f=_("p"),g=P(),w=_("p"),C=j(E),x=P(),I=_("p"),D=_("b"),D.textContent="Members: ",b=j(S),u(r,"class","text-2xl"),u(c,"class",l="mx-4 w-3 h-3 absolute rounded-full bg-green-500 animate-ping motion-reduce:animate-none "+(n[1]?"":"hidden")),u(f,"class",p="mx-4 w-3 h-3 absolute rounded-full "+(n[1]?"bg-green-500":"bg-red-500")),u(a,"class","relative w-10 h-3"),u(w,"class","text-sm text-gray-400"),u(t,"class","flex items-center"),u(I,"class","my-2"),u(e,"class","pt-4 pl-4")},m(y,R){A(y,e,R),d(e,t),d(t,r),d(r,o),d(t,i),d(t,a),d(a,c),d(a,h),d(a,f),d(t,g),d(t,w),d(w,C),d(e,x),d(e,I),d(I,D),d(I,b)},p(y,[R]){R&1&&s!==(s=y[0].name+"")&&te(o,s),R&2&&l!==(l="mx-4 w-3 h-3 absolute rounded-full bg-green-500 animate-ping motion-reduce:animate-none "+(y[1]?"":"hidden"))&&u(c,"class",l),R&2&&p!==(p="mx-4 w-3 h-3 absolute rounded-full "+(y[1]?"bg-green-500":"bg-red-500"))&&u(f,"class",p),R&2&&E!==(E=y[1]?"Sharing cart":"Sharing starting...")&&te(C,E),R&1&&S!==(S=Array.from(y[0].otherUsers).join(", ")+"")&&te(b,S)},i:J,o:J,d(y){y&&U(e)}}}function Do(n,e,t){let r;Pe(n,Gt,o=>t(1,r=o));let{groupInfo:s}=e;return n.$$set=o=>{"groupInfo"in o&&t(0,s=o.groupInfo)},[s,r]}class Ro extends Se{constructor(e){super(),ve(this,e,Do,Ao,be,{groupInfo:0})}}function En(n){let e,t;return e=new Ro({props:{groupInfo:n[0]}}),{c(){de(e.$$.fragment)},m(r,s){ue(e,r,s),t=!0},p(r,s){const o={};s&1&&(o.groupInfo=r[0]),e.$set(o)},i(r){t||(Q(e.$$.fragment,r),t=!0)},o(r){ne(e.$$.fragment,r),t=!1},d(r){he(e,r)}}}function $o(n){let e,t,r,s,o,i=n[0]&&En(n);return t=new Qn({}),s=new tr({}),{c(){i&&i.c(),e=P(),de(t.$$.fragment),r=P(),de(s.$$.fragment)},m(a,c){i&&i.m(a,c),A(a,e,c),ue(t,a,c),A(a,r,c),ue(s,a,c),o=!0},p(a,[c]){a[0]?i?(i.p(a,c),c&1&&Q(i,1)):(i=En(a),i.c(),Q(i,1),i.m(e.parentNode,e)):i&&(at(),ne(i,1,1,()=>{i=null}),ct())},i(a){o||(Q(i),Q(t.$$.fragment,a),Q(s.$$.fragment,a),o=!0)},o(a){ne(i),ne(t.$$.fragment,a),ne(s.$$.fragment,a),o=!1},d(a){a&&(U(e),U(r)),i&&i.d(a),he(t,a),he(s,a)}}}function Mo(n,e,t){let{params:r={}}=e,s;return Xe(async()=>{const o=await Po(r.groupid);o instanceof Error?ce(o.message):t(0,s=o),await De(r.groupid)}),Nn(async()=>{await co(r.groupid)}),n.$$set=o=>{"params"in o&&t(1,r=o.params)},[s,r]}class Lo extends Se{constructor(e){super(),ve(this,e,Mo,$o,be,{params:1})}}class No{constructor(){H(this,"id","");H(this,"name","");H(this,"otherUsers",new Set)}}class kn{constructor(){H(this,"name","");H(this,"otherUsers",new Set)}}function In(n,e,t){const r=n.slice();return r[26]=e[t],r[27]=e,r[28]=t,r}function Pn(n,e,t){const r=n.slice();return r[29]=e[t],r}function Ho(n){let e,t,r;return{c(){e=_("button"),e.innerHTML=`<img src="icons/group.svg" alt="group" class="m-auto h-5 invert"/>
      Create group`,u(e,"id","create-group-btn"),u(e,"class","btn btn-success flex items-center gap-2")},m(s,o){A(s,e,o),t||(r=q(e,"click",n[9]),t=!0)},p:J,d(s){s&&U(e),t=!1,r()}}}function Bo(n){let e,t,r,s,o,i,a,c,l,h,f,p,g,w,E,C,x,I,D,S,b=Te(n[2].otherUsers),y=[];for(let T=0;T<b.length;T+=1)y[T]=Tn(Pn(n,b,T));function R(T,B){return T[4]?Wo:Oo}let $=R(n),O=$(n);return{c(){e=_("fieldset"),t=_("legend"),t.textContent="Create cart group",r=P(),s=_("input"),o=P(),i=_("div"),a=_("p"),a.textContent="Members:",c=P();for(let T=0;T<y.length;T+=1)y[T].c();l=P(),h=_("div"),f=_("input"),p=P(),g=_("button"),g.textContent="+",w=P(),E=_("button"),C=_("img"),I=P(),O.c(),u(t,"class","text-lg font-bold px-1"),u(s,"id","create-group-name"),u(s,"class","form-control"),u(s,"maxlength","30"),u(s,"size","30"),u(s,"placeholder","Group name"),u(a,"class","mr-2"),u(i,"class","flex flex-wrap mr-2 mb-2 px-[5px] py-1 items-center"),u(f,"id","add-user-to-group"),u(f,"class","form-control"),u(f,"size","30"),u(f,"placeholder","New member email"),u(g,"id","add-member-btn"),u(g,"class","btn btn-success w-9 h-9 p-0 ml-2 font-extrabold text-2xl"),u(h,"class","flex"),Ie(C.src,x="icons/group.svg")||u(C,"src",x),u(C,"alt","group"),u(C,"class","m-auto h-5 invert"),u(E,"id","create-group-btn"),u(E,"class","btn btn-success flex items-center mt-4 gap-2"),u(e,"class","mt-4 p-4 border-2 border-gray-300 rounded-lg")},m(T,B){A(T,e,B),d(e,t),d(e,r),d(e,s),fe(s,n[2].name),d(e,o),d(e,i),d(i,a),d(i,c);for(let W=0;W<y.length;W+=1)y[W]&&y[W].m(i,null);d(e,l),d(e,h),d(h,f),fe(f,n[3]),d(h,p),d(h,g),d(e,w),d(e,E),d(E,C),d(E,I),O.m(E,null),D||(S=[q(s,"input",n[16]),q(f,"input",n[18]),q(g,"click",n[8]),q(E,"click",n[9])],D=!0)},p(T,B){if(B[0]&4&&s.value!==T[2].name&&fe(s,T[2].name),B[0]&132){b=Te(T[2].otherUsers);let W;for(W=0;W<b.length;W+=1){const L=Pn(T,b,W);y[W]?y[W].p(L,B):(y[W]=Tn(L),y[W].c(),y[W].m(i,null))}for(;W<y.length;W+=1)y[W].d(1);y.length=b.length}B[0]&8&&f.value!==T[3]&&fe(f,T[3]),$!==($=R(T))&&(O.d(1),O=$(T),O&&(O.c(),O.m(E,null)))},d(T){T&&U(e),Wt(y,T),O.d(),D=!1,ae(S)}}}function Tn(n){let e,t,r=n[29]+"",s,o,i,a,c,l;function h(){return n[17](n[29])}return{c(){e=_("div"),t=_("span"),s=j(r),o=P(),i=_("button"),i.textContent="",a=P(),u(t,"class","align-middle"),u(i,"class","btn btn-danger w-6 h-6 p-0 leading-4 ml-1 font-bold"),u(e,"class","flex mx-3 my-1")},m(f,p){A(f,e,p),d(e,t),d(t,s),d(e,o),d(e,i),d(e,a),c||(l=q(i,"click",h),c=!0)},p(f,p){n=f,p[0]&4&&r!==(r=n[29]+"")&&te(s,r)},d(f){f&&U(e),c=!1,l()}}}function Oo(n){let e;return{c(){e=_("span"),e.textContent="Create Group"},m(t,r){A(t,e,r)},d(t){t&&U(e)}}}function Wo(n){let e;return{c(){e=_("div"),e.innerHTML='<span class="border-4 border-[rgba(0,0,0,0.1)] border-t-white rounded-[50%] w-4 h-4 mr-2 animate-spin"></span> <span>Creating...</span>',u(e,"class","flex items-center")},m(t,r){A(t,e,r)},d(t){t&&U(e)}}}function zo(n){let e,t=Te(n[0]),r=[];for(let s=0;s<t.length;s+=1)r[s]=xn(In(n,t,s));return{c(){for(let s=0;s<r.length;s+=1)r[s].c();e=kt()},m(s,o){for(let i=0;i<r.length;i+=1)r[i]&&r[i].m(s,o);A(s,e,o)},p(s,o){if(o[0]&30753){t=Te(s[0]);let i;for(i=0;i<t.length;i+=1){const a=In(s,t,i);r[i]?r[i].p(a,o):(r[i]=xn(a),r[i].c(),r[i].m(e.parentNode,e))}for(;i<r.length;i+=1)r[i].d(1);r.length=t.length}},d(s){s&&U(e),Wt(r,s)}}}function Fo(n){let e;return{c(){e=_("p"),e.textContent="You have no groups yet."},m(t,r){A(t,e,r)},p:J,d(t){t&&U(e)}}}function Go(n){let e,t,r,s,o,i,a,c;function l(){n[21].call(t,n[27],n[28])}function h(){return n[22](n[26])}return{c(){e=_("div"),t=_("input"),r=P(),s=_("button"),s.innerHTML='<img src="icons/check.svg" alt="Accept" class="p-[2px] invert" aria-hidden="true"/>',o=P(),i=_("button"),i.textContent="Cancel",u(t,"id","edit-group-name-input"),u(t,"class","form-control-small"),u(t,"aria-label","Group name input"),u(s,"class","btn btn-success h-8 w-8 p-0"),u(s,"aria-label","Submit name edit"),u(i,"class","btn btn-danger px-1 leading-4 h-8"),u(i,"aria-label","Cancel name edit"),u(e,"class","flex items-center gap-1")},m(f,p){A(f,e,p),d(e,t),fe(t,n[26].name),d(e,r),d(e,s),d(e,o),d(e,i),a||(c=[q(t,"input",l),q(s,"click",h),q(i,"click",n[14])],a=!0)},p(f,p){n=f,p[0]&1&&t.value!==n[26].name&&fe(t,n[26].name)},d(f){f&&U(e),a=!1,ae(c)}}}function qo(n){let e,t,r,s,o,i,a=n[26].name+"",c,l,h,f,p,g,w,E,C,x,I;function D(){return n[19](n[26])}function S(){return n[20](n[26])}return{c(){e=_("div"),t=_("a"),r=Zt("svg"),s=Zt("path"),o=P(),i=_("span"),c=j(a),h=P(),f=_("button"),p=_("img"),E=P(),C=_("button"),C.innerHTML='<img src="icons/delete.svg" alt="Delete" class="m-auto invert"/>',u(s,"d","M152.1 38.2c9.9 8.9 10.7 24 1.8 33.9l-72 80c-4.4 4.9-10.6 7.8-17.2 7.9s-12.9-2.4-17.6-7L7 113C-2.3 103.6-2.3 88.4 7 79s24.6-9.4 33.9 0l22.1 22.1 55.1-61.2c8.9-9.9 24-10.7 33.9-1.8zm0 160c9.9 8.9 10.7 24 1.8 33.9l-72 80c-4.4 4.9-10.6 7.8-17.2 7.9s-12.9-2.4-17.6-7L7 273c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l22.1 22.1 55.1-61.2c8.9-9.9 24-10.7 33.9-1.8zM224 96c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H256c-17.7 0-32-14.3-32-32zm0 160c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H256c-17.7 0-32-14.3-32-32zM160 416c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H192c-17.7 0-32-14.3-32-32zM48 368a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"),u(r,"class","w-4 invert"),u(r,"xmlns","http://www.w3.org/2000/svg"),u(r,"viewBox","0 0 512 512"),u(t,"href",l="/groupcart/"+n[26].id),u(t,"class","btn btn-primary inline-flex gap-2"),Ie(p.src,g="icons/edit.svg")||u(p,"src",g),u(p,"alt","Edit"),u(p,"class","m-auto invert"),u(f,"class","btn btn-success h-8 w-8 p-[3px]"),u(f,"aria-label","Edit group name"),f.disabled=w=n[5]!==null,u(C,"class","btn btn-danger p-[4px] w-8 h-8 text-lg leading-4"),u(C,"aria-label","Delete group"),u(e,"class","flex items-center gap-1")},m(b,y){A(b,e,y),d(e,t),d(t,r),d(r,s),d(t,o),d(t,i),d(i,c),d(e,h),d(e,f),d(f,p),d(e,E),d(e,C),x||(I=[Ot(Ft.call(null,t)),q(f,"click",D),q(C,"click",S)],x=!0)},p(b,y){n=b,y[0]&1&&a!==(a=n[26].name+"")&&te(c,a),y[0]&1&&l!==(l="/groupcart/"+n[26].id)&&u(t,"href",l),y[0]&32&&w!==(w=n[5]!==null)&&(f.disabled=w)},d(b){b&&U(e),x=!1,ae(I)}}}function xn(n){let e,t,r,s,o=Array.from(n[26].otherUsers).join(", ")+"",i,a;function c(f,p){return f[5]!==f[26]?qo:Go}let l=c(n),h=l(n);return{c(){e=_("fieldset"),h.c(),t=P(),r=_("p"),s=j("Members: You, "),i=j(o),a=P(),u(e,"class","flex flex-wrap items-center gap-3 mt-4 p-4 border-2 border-gray-300 rounded-lg")},m(f,p){A(f,e,p),h.m(e,null),d(e,t),d(e,r),d(r,s),d(r,i),d(e,a)},p(f,p){l===(l=c(f))&&h?h.p(f,p):(h.d(1),h=l(f),h&&(h.c(),h.m(e,t))),p[0]&1&&o!==(o=Array.from(f[26].otherUsers).join(", ")+"")&&te(i,o)},d(f){f&&U(e),h.d()}}}function Vo(n){let e,t,r,s,o;function i(g,w){return g[1]?Bo:Ho}let a=i(n),c=a(n);function l(g,w){return!g[0]||g[0].length===0?Fo:zo}let h=l(n),f=h(n),p={header:"Confirm delete",message:"This will delete the group and its products for all group members, are you sure?"};return s=new er({props:p}),n[23](s),s.$on("ok",n[15]),s.$on("cancel",n[10]),{c(){e=_("div"),c.c(),t=P(),f.c(),r=P(),de(s.$$.fragment),u(e,"class","p-4")},m(g,w){A(g,e,w),c.m(e,null),d(e,t),f.m(e,null),A(g,r,w),ue(s,g,w),o=!0},p(g,w){a===(a=i(g))&&c?c.p(g,w):(c.d(1),c=a(g),c&&(c.c(),c.m(e,t))),h===(h=l(g))&&f?f.p(g,w):(f.d(1),f=h(g),f&&(f.c(),f.m(e,null)));const E={};s.$set(E)},i(g){o||(Q(s.$$.fragment,g),o=!0)},o(g){ne(s.$$.fragment,g),o=!1},d(g){g&&(U(e),U(r)),c.d(),f.d(),n[23](null),he(s,g)}}}function Xo(n,e,t){let r,s=!1,o=new kn,i="",a=!1,c="",l=null,h=null,f;Xe(async()=>{if((await lt()).isAuthenticated){const z=await Io();z instanceof Error?(ce("Could not load groups, please try again later"),console.log(z.message)):t(0,r=z)}});function p(L){o.otherUsers.delete(L),t(2,o)}function g(){o.otherUsers.add(i),t(3,i=""),t(2,o)}async function w(){if(s){t(4,a=!0);try{const L=await To(o);if(L instanceof Error)ce(L.message);else{const z=new No;z.id=L,z.name=o.name,z.otherUsers=o.otherUsers,r==null||r.push(z),t(0,r),t(1,s=!1),t(2,o=new kn)}}catch(L){L instanceof Error&&ce(L.message)}finally{t(4,a=!1)}}else t(1,s=!0)}function E(){h=null}function C(L){c=L.name,t(5,l=L)}function x(L){h=L,f&&f.showModal()}async function I(L){if(t(5,l=null),L.name!==c)try{const z=await xo(L.id,L.name);z instanceof Error&&ce(z.message)}catch(z){z instanceof Error&&ce(z.message)}c=""}function D(){t(5,l=null),c=""}async function S(){if(h)try{const L=await Uo(h.id);L instanceof Error?ce(L.message):(t(0,r=r==null?void 0:r.filter(z=>z.id!==(h==null?void 0:h.id))),h=null)}catch(L){L instanceof Error&&ce(L.message)}}function b(){o.name=this.value,t(2,o)}const y=L=>p(L);function R(){i=this.value,t(3,i)}const $=L=>C(L),O=L=>x(L);function T(L,z){L[z].name=this.value,t(0,r)}const B=L=>I(L);function W(L){Ne[L?"unshift":"push"](()=>{f=L,t(6,f)})}return[r,s,o,i,a,l,f,p,g,w,E,C,x,I,D,S,b,y,R,$,O,T,B,W]}class Ko extends Se{constructor(e){super(),ve(this,e,Xo,Vo,be,{},null,[-1,-1])}}const jo={"/":ko,"/groupcart/:groupid":Lo,"/managegroups":Ko};function Jo(n){let e,t,r,s,o=n[2].header+"",i,a,c,l,h,f,p,g,w=n[2].message+"",E,C,x;return{c(){e=_("dialog"),t=_("div"),r=_("div"),s=_("h3"),i=j(o),a=P(),c=_("form"),l=_("button"),l.textContent="",f=P(),p=_("div"),g=_("h4"),E=j(w),u(s,"class","text-xl font-semibold"),u(l,"class","text-white font-bold w-6 h-6 leading-5 bg-transparent"),u(c,"method","dialog"),u(r,"class",h="flex justify-between items-center h-8 text-white p-2 "+n[1]),u(p,"class","p-4 dark:bg-slate-900 dark:text-white"),u(t,"class","font-semibold"),u(e,"id","modal"),u(e,"class","border-2 border-gray-500 mt-32 rounded max-w-md animate-fade-in-down p-0 backdrop:bg-gray-900/60")},m(I,D){A(I,e,D),d(e,t),d(t,r),d(r,s),d(s,i),d(r,a),d(r,c),d(c,l),d(t,f),d(t,p),d(p,g),d(g,E),n[4](e),C||(x=q(l,"click",n[3]),C=!0)},p(I,[D]){D&4&&o!==(o=I[2].header+"")&&te(i,o),D&2&&h!==(h="flex justify-between items-center h-8 text-white p-2 "+I[1])&&u(r,"class",h),D&4&&w!==(w=I[2].message+"")&&te(E,w)},i:J,o:J,d(I){I&&U(e),n[4](null),C=!1,x()}}}function Yo(n,e,t){let r;Pe(n,st,l=>t(2,r=l));let s,o="bg-green-600";st.subscribe(l=>{s&&l.header!==null&&l.message!==null&&(a(),s.showModal())});function i(){Dr()}function a(){t(1,o=r.header==="Error"?"bg-red-600":"bg-green-600")}function c(l){Ne[l?"unshift":"push"](()=>{s=l,t(0,s)})}return[s,o,r,i,c]}class Zo extends Se{constructor(e){super(),ve(this,e,Yo,Jo,be,{})}}function Un(n){let e,t=Rn(n[1],n[0])+"",r,s,o;return{c(){e=_("label"),r=j(t),s=P(),o=_("input"),u(e,"for","profile-btn"),u(e,"class","block relative z-10 bg-green-500 border-2 text-center leading-8 border-green-600 w-9 h-9 rounded-full hover:border-black hover:dark:border-white"),u(e,"aria-label","profile-btn"),u(o,"type","checkbox"),u(o,"id","profile-btn"),u(o,"class","appearance-none absolute top-0 w-9 h-9 rounded-full svelte-1e76bah")},m(i,a){A(i,e,a),d(e,r),A(i,s,a),A(i,o,a)},p(i,a){a&3&&t!==(t=Rn(i[1],i[0])+"")&&te(r,t)},d(i){i&&(U(e),U(s),U(o))}}}function An(n){let e,t,r,s,o;return{c(){e=_("p"),t=_("img"),s=P(),o=j(n[1]),Ie(t.src,r="icons/user.svg")||u(t,"src",r),u(t,"alt","User"),u(t,"class","h-4 mr-2 dark:invert"),u(t,"aria-hidden","true"),u(e,"class","flex items-center")},m(i,a){A(i,e,a),d(e,t),d(e,s),d(e,o)},p(i,a){a&2&&te(o,i[1])},d(i){i&&U(e)}}}function Dn(n){let e,t,r,s,o;return{c(){e=_("p"),t=_("img"),s=P(),o=j(n[0]),Ie(t.src,r="icons/email.svg")||u(t,"src",r),u(t,"alt","User"),u(t,"class","h-4 mr-2 dark:invert"),u(t,"aria-hidden","true"),u(e,"class","flex text-sm items-center")},m(i,a){A(i,e,a),d(e,t),d(e,s),d(e,o)},p(i,a){a&1&&te(o,i[0])},d(i){i&&U(e)}}}function Qo(n){let e,t,r,s,o,i,a,c,l,h,f,p,g,w,E=n[1]&&n[0]&&Un(n),C=n[1]&&An(n),x=n[0]&&Dn(n);return{c(){e=_("div"),E&&E.c(),t=P(),r=_("div"),C&&C.c(),s=P(),x&&x.c(),o=P(),i=_("p"),a=_("img"),l=P(),h=_("a"),h.textContent="Manage groups",f=P(),p=_("form"),p.innerHTML='<img src="icons/logout.svg" alt="Log out" class="h-4 mr-2 dark:invert" aria-hidden="true"/> <button id="signout-btn" class="hover:text-gray-400 hover:underline" type="submit">Sign out</button>',u(a,"class","h-4 mr-2 dark:invert"),Ie(a.src,c="icons/group.svg")||u(a,"src",c),u(a,"alt","Group"),u(a,"aria-hidden","true"),u(h,"href","/managegroups"),u(h,"class","hover:text-gray-400 hover:underline"),u(i,"class","flex items-center"),u(p,"id","signout-form"),u(p,"method","post"),u(p,"action","api/Account/Logout"),u(p,"class","flex items-center"),u(r,"id","profile-menu"),u(r,"class","min-w-max hidden absolute rounded-lg right-0 p-3 mt-1 border-2 border-black bg-[#FEF9F3] dark:bg-gray-800 dark:border-white svelte-1e76bah"),u(e,"class","relative z-20 select-none")},m(I,D){A(I,e,D),E&&E.m(e,null),d(e,t),d(e,r),C&&C.m(r,null),d(r,s),x&&x.m(r,null),d(r,o),d(r,i),d(i,a),d(i,l),d(i,h),d(r,f),d(r,p),g||(w=[Ot(Ft.call(null,h)),q(h,"click",ei)],g=!0)},p(I,[D]){I[1]&&I[0]?E?E.p(I,D):(E=Un(I),E.c(),E.m(e,t)):E&&(E.d(1),E=null),I[1]?C?C.p(I,D):(C=An(I),C.c(),C.m(r,s)):C&&(C.d(1),C=null),I[0]?x?x.p(I,D):(x=Dn(I),x.c(),x.m(r,o)):x&&(x.d(1),x=null)},i:J,o:J,d(I){I&&U(e),E&&E.d(),C&&C.d(),x&&x.d(),g=!1,ae(w)}}}function Rn(n,e){if(n){const t=n.toUpperCase().split(" ",2);return t.length===2?t[0][0]+t[1][0]:n.substring(0,2).toUpperCase()}return e?e.substring(0,2).toUpperCase():"U"}function ei(){const n=document.getElementById("profile-btn");n.checked=!1}function ti(n,e,t){let r,s;return Xe(async()=>{var i,a;const o=await lt();t(0,r=(i=o.claims.find(c=>c.type===Mr))==null?void 0:i.value),t(1,s=(a=o.claims.find(c=>c.type===Lr))==null?void 0:a.value)}),[r,s]}class ni extends Se{constructor(e){super(),ve(this,e,ti,Qo,be,{})}}function ri(n){let e;return{c(){e=_("a"),e.textContent="Log in",u(e,"id","login-link"),u(e,"class","btn btn-success font-bold text-lg mx-4 align-middle"),u(e,"href","api/Account/Login")},m(t,r){A(t,e,r)},i:J,o:J,d(t){t&&U(e)}}}function si(n){let e,t;return e=new ni({}),{c(){de(e.$$.fragment)},m(r,s){ue(e,r,s),t=!0},i(r){t||(Q(e.$$.fragment,r),t=!0)},o(r){ne(e.$$.fragment,r),t=!1},d(r){he(e,r)}}}function oi(n){let e,t,r,s,o,i,a,c,l,h,f,p,g,w,E,C;const x=[si,ri],I=[];function D(S,b){return S[0]&&S[0].isAuthenticated?0:1}return i=D(n),a=I[i]=x[i](n),f=new Cr({props:{routes:jo}}),g=new Zo({}),{c(){e=_("nav"),t=_("div"),r=_("div"),s=_("a"),s.innerHTML='<img width="48" height="48" src="/cart128.png" alt="Logo"/> <span class="font-bold text-xl dark:text-gray-100">Grocery List Helper</span>',o=P(),a.c(),c=P(),l=_("main"),h=_("div"),de(f.$$.fragment),p=P(),de(g.$$.fragment),u(s,"href","/"),u(s,"class","flex items-center"),u(r,"class","flex items-center select-none"),u(t,"class","flex justify-between w-full max-w-[--content-max-width] px-4 items-center"),u(e,"class","flex justify-center bg-gray-200 w-full dark:bg-gray-500 dark:text-white"),u(h,"class","bg-gray-100 mx-auto max-w-[--content-max-width] dark:bg-gray-800 dark:text-white"),u(l,"class","min-h-full bg-[url('../store-transparent.webp')] bg-cover")},m(S,b){A(S,e,b),d(e,t),d(t,r),d(r,s),d(t,o),I[i].m(t,null),A(S,c,b),A(S,l,b),d(l,h),ue(f,h,null),d(h,p),ue(g,h,null),w=!0,E||(C=Ot(Ft.call(null,s)),E=!0)},p(S,[b]){let y=i;i=D(S),i!==y&&(at(),ne(I[y],1,1,()=>{I[y]=null}),ct(),a=I[i],a||(a=I[i]=x[i](S),a.c()),Q(a,1),a.m(t,null))},i(S){w||(Q(a),Q(f.$$.fragment,S),Q(g.$$.fragment,S),w=!0)},o(S){ne(a),ne(f.$$.fragment,S),ne(g.$$.fragment,S),w=!1},d(S){S&&(U(e),U(c),U(l)),I[i].d(),he(f),he(g),E=!1,C()}}}function ii(n,e,t){let r;return Xe(async()=>{const s=await lt();t(0,r=s)}),[r]}class ai extends Se{constructor(e){super(),ve(this,e,ii,oi,be,{})}}const mt=document.getElementById("app");mt&&mt.hasChildNodes()&&(mt.innerHTML="");new ai({target:mt});
