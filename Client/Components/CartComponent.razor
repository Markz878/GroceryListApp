@inherits CartComponentBase

<table>
    <thead>
        <tr>
            <th>Reorder</th>
            <th>Collected</th>
            <th class="min-w-[150px]" @onclick="ChangeSortDirectionAndSortItems" style="@(ViewModel.IsPolling ? "" : "cursor: pointer;")">
                Product
                @if (sortState != SortState.None)
                {
                    <img class="sort-icon" src=@(sortState == SortState.Ascending ? "arrow-down.svg" : "arrow-up.svg") />
                }
            </th>
            <th class="min-w-[100px]">Amount</th>
            <th class="min-w-[100px]">Price</th>
            <th>Total</th>
            <th></th>
            <th></th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td></td>
            <td><button id="add-cartproduct-button" type="submit" class="btn btn-success" @onclick="AddNewProduct" aria-label="Add product">Add</button></td>
            <td>
                <input id="newproduct-name-input" type="text" list="products" class="form-control" aria-label="Product name input" autocomplete="off" @bind="newProduct.Name" @onfocusout="GetItemPrice" @ref="NewProductNameBox" />
                <datalist id="products">
                    @foreach (var product in ViewModel.StoreProducts.Where(x => !ViewModel.CartProducts.Select(y => y.Name).Contains(x.Name)))
                    {
                        <option value="@product.Name" />
                    }
                </datalist>
            </td>
            <td><input id="newproduct-amount-input" type="number" step="1" min="1" class="form-control text-center" aria-label="Product amount input" @bind="newProduct.Amount" /></td>
            <td><input id="newproduct-price-input" type="number" step="0.01" min="0" class="form-control text-center" aria-label="Product unit price input" @bind="newProduct.UnitPrice" /></td>
            <td></td>
        </tr>
        @foreach (var (item, index) in ViewModel.CartProducts.Where(x => !ViewModel.ShowOnlyUncollected || !x.IsCollected).OrderBy(x => x.Order).Select((x, i) => (x, i)))
        {
            <tr class="@GetRowClass(item)" @key=item.Name>
                @if (item != editingItem)
                {
                    <td><button id="reorder-button-@index" class="btn btn-primary leading-5 h-8 @(item==movingItem ? "bg-blue-800" : "")" title="Move" aria-label="Move" @onclick="()=>Move(item)"><i class="fas fa-sort"></i></button></td>
                    <td><input id="item-collected-checkbox-@index" type="checkbox" class="scale-150" checked="@item.IsCollected" @onchange=@((e)=>MarkItemCollected(e, item)) /></td>
                    <td id="item-name-@index" class="@(item.IsCollected ? "line-through" : "")" aria-label="Product name">@item.Name</td>
                    <td id="item-amount-@index" aria-label="Amount">@item.Amount</td>
                    <td id="item-unitprice-@index" aria-label="Unit price">@item.UnitPrice.ToString("N2")</td>
                    <td id="item-totalprice-@index" aria-label="Total price">@item.Total.ToString("N2")</td>
                    <td><button id="edit-product-button-@index" class="btn btn-success" @onclick="()=>StartEditItem(item)" aria-label="Edit product" disabled=@item.IsCollected><i class="fas fa-edit"></i></button></td>
                    <td><button id="delete-product-button-@index" class="btn btn-danger" @onclick="()=>RemoveProduct(item)" aria-label="Delete product" disabled=@item.IsCollected>X</button></td>
                }
                else
                {
                    <td></td>
                    <td><input id="item-collected-checkbox-@index" type="checkbox" class="hidden" checked="@item.IsCollected"/></td>
                    <td id="item-name-@index" class="@(item.IsCollected ? "line-through" : "")" aria-label="Product name">@item.Name</td>
                    <td><input id="edit-item-amount-input-@index" type="number" step="0.01" min="0" class="form-control text-center" aria-label="Amount" @bind="item.Amount" /></td>
                    <td><input id="edit-item-unitprice-input-@index" type="number" step="0.01" min="0" class="form-control text-center" aria-label="Unit price" @bind="item.UnitPrice" /></td>
                    <td id="item-totalprice-@index">@item.Total.ToString("N2")</td>
                    <td colspan="2"><button id="update-product-button-@index" class="btn btn-success h-8 p-t-0 p-b-0 leading-4" @onclick=@(()=>UpdateCartProduct(item)) aria-label="Submit change" disabled=@item.IsCollected>Submit</button></td>
                }
            </tr>
        }
    </tbody>
</table>