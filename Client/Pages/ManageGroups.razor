@page "/managegroups"
@inherits ManageGroupsBase

<AuthorizedView>
    <div class="p-4">
        @if (isCreatingNewGroup)
        {
            <fieldset class="mt-4 p-4 border-2 border-gray-300 rounded-lg">
                <legend class="text-lg font-bold px-1">Create cart group</legend>
                <input id="create-group-name" class="form-control" @bind="createCartGroupRequest.Name" maxlength="30" size="30" placeholder="Group name" />
                <div class="flex flex-wrap mr-2 mb-2 px-[5px] py-1 items-center">
                    <p class="mr-2">Members: </p>
                    @foreach (string email in createCartGroupRequest.OtherUsers)
                    {
                        <div class="flex mx-3 my-1">
                            <span class="align-middle">@email</span>
                            <button class="btn btn-danger w-6 h-6 p-0 leading-4 ml-1 font-bold" @onclick="() => RemoveNewMember(email)">&times;</button>
                        </div>
                    }
                </div>
                <div class="flex">
                    <input id="add-user-to-group" class="form-control" @bind="newMemberEmail.Email" size="30" placeholder="New member email" />
                    <button class="btn btn-success ml-2 font-extrabold text-2xl leading-4" @onclick="AddMember">+</button>
                </div>
                <button class="btn btn-success flex items-center mt-4 gap-2 w-36" @onclick=CreateGroup>
                    <svg class="w-4 invert" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M335.5 4l288 160c15.4 8.6 21 28.1 12.4 43.5s-28.1 21-43.5 12.4L320 68.6 47.5 220c-15.4 8.6-34.9 3-43.5-12.4s-3-34.9 12.4-43.5L304.5 4c9.7-5.4 21.4-5.4 31.1 0zM320 160a40 40 0 1 1 0 80 40 40 0 1 1 0-80zM144 256a40 40 0 1 1 0 80 40 40 0 1 1 0-80zm312 40a40 40 0 1 1 80 0 40 40 0 1 1 -80 0zM226.9 491.4L200 441.5V480c0 17.7-14.3 32-32 32H120c-17.7 0-32-14.3-32-32V441.5L61.1 491.4c-6.3 11.7-20.8 16-32.5 9.8s-16-20.8-9.8-32.5l37.9-70.3c15.3-28.5 45.1-46.3 77.5-46.3h19.5c16.3 0 31.9 4.5 45.4 12.6l33.6-62.3c15.3-28.5 45.1-46.3 77.5-46.3h19.5c32.4 0 62.1 17.8 77.5 46.3l33.6 62.3c13.5-8.1 29.1-12.6 45.4-12.6h19.5c32.4 0 62.1 17.8 77.5 46.3l37.9 70.3c6.3 11.7 1.9 26.2-9.8 32.5s-26.2 1.9-32.5-9.8L552 441.5V480c0 17.7-14.3 32-32 32H472c-17.7 0-32-14.3-32-32V441.5l-26.9 49.9c-6.3 11.7-20.8 16-32.5 9.8s-16-20.8-9.8-32.5l36.3-67.5c-1.7-1.7-3.2-3.6-4.3-5.8L376 345.5V400c0 17.7-14.3 32-32 32H296c-17.7 0-32-14.3-32-32V345.5l-26.9 49.9c-1.2 2.2-2.6 4.1-4.3 5.8l36.3 67.5c6.3 11.7 1.9 26.2-9.8 32.5s-26.2 1.9-32.5-9.8z" /></svg>
                    @if (isBusy is false)
                    {
                        <span>Create Group</span>
                    }
                    else
                    {
                        <div class="flex items-center">
                            <span class="border-4 border-[rgba(0,0,0,0.1)] border-t-white rounded-[50%] w-4 h-4 mr-2 animate-spin"></span>
                            <span>Creating...</span>
                        </div>
                    }
                </button>
            </fieldset>
        }
        else
        {
            <button class="btn btn-success flex items-center" @onclick=CreateGroup>
                <svg class="invert mr-2 w-4 xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M335.5 4l288 160c15.4 8.6 21 28.1 12.4 43.5s-28.1 21-43.5 12.4L320 68.6 47.5 220c-15.4 8.6-34.9 3-43.5-12.4s-3-34.9 12.4-43.5L304.5 4c9.7-5.4 21.4-5.4 31.1 0zM320 160a40 40 0 1 1 0 80 40 40 0 1 1 0-80zM144 256a40 40 0 1 1 0 80 40 40 0 1 1 0-80zm312 40a40 40 0 1 1 80 0 40 40 0 1 1 -80 0zM226.9 491.4L200 441.5V480c0 17.7-14.3 32-32 32H120c-17.7 0-32-14.3-32-32V441.5L61.1 491.4c-6.3 11.7-20.8 16-32.5 9.8s-16-20.8-9.8-32.5l37.9-70.3c15.3-28.5 45.1-46.3 77.5-46.3h19.5c16.3 0 31.9 4.5 45.4 12.6l33.6-62.3c15.3-28.5 45.1-46.3 77.5-46.3h19.5c32.4 0 62.1 17.8 77.5 46.3l33.6 62.3c13.5-8.1 29.1-12.6 45.4-12.6h19.5c32.4 0 62.1 17.8 77.5 46.3l37.9 70.3c6.3 11.7 1.9 26.2-9.8 32.5s-26.2 1.9-32.5-9.8L552 441.5V480c0 17.7-14.3 32-32 32H472c-17.7 0-32-14.3-32-32V441.5l-26.9 49.9c-6.3 11.7-20.8 16-32.5 9.8s-16-20.8-9.8-32.5l36.3-67.5c-1.7-1.7-3.2-3.6-4.3-5.8L376 345.5V400c0 17.7-14.3 32-32 32H296c-17.7 0-32-14.3-32-32V345.5l-26.9 49.9c-1.2 2.2-2.6 4.1-4.3 5.8l36.3 67.5c6.3 11.7 1.9 26.2-9.8 32.5s-26.2 1.9-32.5-9.8z" /></svg>
                Create group
            </button>
        }
        @if (cartGroups is null || cartGroups.Count == 0)
        {
            <p>You have no groups yet.</p>
        }
        else
        {
            @foreach (CartGroup group in cartGroups)
            {
                <fieldset class="mt-4 p-4 border-2 border-gray-300 rounded-lg">
                    @if (isEditingGroup != group)
                    {
                        <button class="btn btn-primary inline-flex align-middle gap-2" aria-label="Select group cart" @onclick="() => SelectCart(group.Id)">
                            <svg class="w-4 invert" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><path d="M152.1 38.2c9.9 8.9 10.7 24 1.8 33.9l-72 80c-4.4 4.9-10.6 7.8-17.2 7.9s-12.9-2.4-17.6-7L7 113C-2.3 103.6-2.3 88.4 7 79s24.6-9.4 33.9 0l22.1 22.1 55.1-61.2c8.9-9.9 24-10.7 33.9-1.8zm0 160c9.9 8.9 10.7 24 1.8 33.9l-72 80c-4.4 4.9-10.6 7.8-17.2 7.9s-12.9-2.4-17.6-7L7 273c-9.4-9.4-9.4-24.6 0-33.9s24.6-9.4 33.9 0l22.1 22.1 55.1-61.2c8.9-9.9 24-10.7 33.9-1.8zM224 96c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H256c-17.7 0-32-14.3-32-32zm0 160c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H256c-17.7 0-32-14.3-32-32zM160 416c0-17.7 14.3-32 32-32H480c17.7 0 32 14.3 32 32s-14.3 32-32 32H192c-17.7 0-32-14.3-32-32zM48 368a48 48 0 1 1 0 96 48 48 0 1 1 0-96z" /></svg>
                            <span>@group.Name</span>
                        </button>
                        <button class="btn btn-success h-8 w-8 p-0 text-sm" @onclick="() => EditGroup(group)" aria-label="Edit group name" disabled="@(isEditingGroup != null)">
                            <i class="fa fa-edit" aria-hidden="true" />
                        </button>
                        <button class="btn btn-danger p-0 w-8 h-8 text-lg leading-4" @onclick="() => ShowDeleteConfirm(group)" aria-label="Delete group">&times;</button>
                    }
                    else
                    {
                        <input id="edit-group-name-input" class="h-8 form-control-small" aria-label="Group name input" @bind="group.Name" />
                        <button class="btn btn-success h-8 w-8 p-0" aria-label="Submit name edit" @onclick="() => SubmitEditGroup(group)">
                            <i class="fa fa-check" aria-hidden="true" />
                        </button>
                        <button class="btn btn-danger p-0 w-8 h-8 text-lg" aria-label="Cancel name edit" @onclick="() => StopEditGroup()">&times;</button>
                    }
                    <p class="mt-2 mb-0">Members: You, @string.Join(", ", group.OtherUsers)</p>
                </fieldset>
            }
        }
    </div>
    <Confirm Header="Confirm delete" Message="This will delete the group and its products for all group members, are you sure?" OkCallback="DeleteGroup" CancelCallback="CancelGroupDelete" @ref=confirm />
</AuthorizedView>
